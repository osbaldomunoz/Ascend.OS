<!DOCTYPE html>
<html lang="en" data-theme="ocean">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCEND v1.3.9 - Your Growth Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        /* ============================================
           CSS VARIABLES & THEMES (Same as v1.2)
           ============================================ */
        :root {
            --sidebar-width: 240px;
            --sidebar-collapsed: 60px;
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-full: 9999px;
            --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --z-sticky: 200;
            --z-modal: 1000;
            --z-toast: 2000;
        }

        /* THEMES */
        [data-theme="ocean"] {
            --bg-primary: #0a0e27; --bg-secondary: #151932; --bg-tertiary: #1e2541;
            --accent-primary: #00d4ff; --accent-secondary: #0095ff;
            --text-primary: #e0e7ff; --text-secondary: #94a3b8; --text-tertiary: #64748b;
            --success: #10b981; --warning: #f59e0b; --danger: #ef4444;
            --glass-bg: rgba(30, 37, 65, 0.6); --glass-border: rgba(255, 255, 255, 0.1);
        }
        [data-theme="sakura"] {
            --bg-primary: #1a0a1e; --bg-secondary: #2d1432; --bg-tertiary: #3d1f45;
            --accent-primary: #ff6b9d; --accent-secondary: #c084fc;
            --text-primary: #fce7f3; --text-secondary: #e9d5ff; --text-tertiary: #c4b5fd;
            --success: #34d399; --warning: #fbbf24; --danger: #f87171;
            --glass-bg: rgba(61, 31, 69, 0.6); --glass-border: rgba(255, 255, 255, 0.1);
        }
        [data-theme="cyber"] {
            --bg-primary: #0a1a0f; --bg-secondary: #0f2818; --bg-tertiary: #1a3d2a;
            --accent-primary: #00ff88; --accent-secondary: #00cc6a;
            --text-primary: #d1fae5; --text-secondary: #86efac; --text-tertiary: #4ade80;
            --success: #22c55e; --warning: #eab308; --danger: #ef4444;
            --glass-bg: rgba(26, 61, 42, 0.6); --glass-border: rgba(0, 255, 136, 0.2);
        }
        [data-theme="coral"] {
            --bg-primary: #1a0f0a; --bg-secondary: #2d1812; --bg-tertiary: #452620;
            --accent-primary: #ff6b6b; --accent-secondary: #ff8787;
            --text-primary: #ffe4e6; --text-secondary: #fecdd3; --text-tertiary: #fda4af;
            --success: #10b981; --warning: #f59e0b; --danger: #dc2626;
            --glass-bg: rgba(69, 38, 32, 0.6); --glass-border: rgba(255, 107, 107, 0.2);
        }
        [data-theme="emerald"] {
            --bg-primary: #0a1f1a; --bg-secondary: #0f2e27; --bg-tertiary: #1a3d35;
            --accent-primary: #10b981; --accent-secondary: #059669;
            --text-primary: #d1fae5; --text-secondary: #a7f3d0; --text-tertiary: #6ee7b7;
            --success: #22c55e; --warning: #f59e0b; --danger: #ef4444;
            --glass-bg: rgba(26, 61, 53, 0.6); --glass-border: rgba(16, 185, 129, 0.2);
        }
        [data-theme="lavender"] {
            --bg-primary: #14102a; --bg-secondary: #1e1538; --bg-tertiary: #2d1f4d;
            --accent-primary: #a78bfa; --accent-secondary: #8b5cf6;
            --text-primary: #ede9fe; --text-secondary: #ddd6fe; --text-tertiary: #c4b5fd;
            --success: #34d399; --warning: #fbbf24; --danger: #f87171;
            --glass-bg: rgba(45, 31, 77, 0.6); --glass-border: rgba(167, 139, 250, 0.2);
        }
        [data-theme="crimson"] {
            --bg-primary: #1a0a0a; --bg-secondary: #2d1414; --bg-tertiary: #451f1f;
            --accent-primary: #ef4444; --accent-secondary: #dc2626;
            --text-primary: #fee2e2; --text-secondary: #fecaca; --text-tertiary: #fca5a5;
            --success: #10b981; --warning: #f59e0b; --danger: #dc2626;
            --glass-bg: rgba(69, 31, 31, 0.6); --glass-border: rgba(239, 68, 68, 0.2);
        }
        [data-theme="gold"] {
            --bg-primary: #1a1504; --bg-secondary: #2d2408; --bg-tertiary: #45360d;
            --accent-primary: #fbbf24; --accent-secondary: #f59e0b;
            --text-primary: #fef3c7; --text-secondary: #fde68a; --text-tertiary: #fcd34d;
            --success: #10b981; --warning: #f97316; --danger: #ef4444;
            --glass-bg: rgba(69, 54, 13, 0.6); --glass-border: rgba(251, 191, 36, 0.2);
        }
        [data-theme="arctic"] {
            --bg-primary: #0a1621; --bg-secondary: #0f1f2e; --bg-tertiary: #1a2d3f;
            --accent-primary: #38bdf8; --accent-secondary: #0ea5e9;
            --text-primary: #e0f2fe; --text-secondary: #bae6fd; --text-tertiary: #7dd3fc;
            --success: #10b981; --warning: #f59e0b; --danger: #ef4444;
            --glass-bg: rgba(26, 45, 63, 0.6); --glass-border: rgba(56, 189, 248, 0.2);
        }
        [data-theme="midnight"] {
            --bg-primary: #0f0a1a; --bg-secondary: #1a0f2e; --bg-tertiary: #271a42;
            --accent-primary: #818cf8; --accent-secondary: #6366f1;
            --text-primary: #e0e7ff; --text-secondary: #c7d2fe; --text-tertiary: #a5b4fc;
            --success: #34d399; --warning: #fbbf24; --danger: #f87171;
            --glass-bg: rgba(39, 26, 66, 0.6); --glass-border: rgba(129, 140, 248, 0.2);
        }
        [data-theme="nature"] {
            --bg-primary: #0b130d; --bg-secondary: #121d14; --bg-tertiary: #1c2e1e;
            --accent-primary: #5a9e6f; --accent-secondary: #3d7a52;
            --text-primary: #ddeedd; --text-secondary: #a8c5a8; --text-tertiary: #6e9470;
            --success: #4ade80; --warning: #d97706; --danger: #ef4444;
            --glass-bg: rgba(28, 46, 30, 0.65); --glass-border: rgba(90, 158, 111, 0.18);
        }
        [data-theme="mono"] {
            --bg-primary: #0a0a0a; --bg-secondary: #141414; --bg-tertiary: #1f1f1f;
            --accent-primary: #e8e8e8; --accent-secondary: #b0b0b0;
            --text-primary: #f5f5f5; --text-secondary: #aaaaaa; --text-tertiary: #666666;
            --success: #6ee7b7; --warning: #fbbf24; --danger: #f87171;
            --glass-bg: rgba(31, 31, 31, 0.7); --glass-border: rgba(255, 255, 255, 0.1);
        }
        [data-theme="earth"] {
            --bg-primary: #150e0a; --bg-secondary: #221610; --bg-tertiary: #322018;
            --accent-primary: #c4703a; --accent-secondary: #a85a2a;
            --text-primary: #f5e6d8; --text-secondary: #d4b89a; --text-tertiary: #9e7d60;
            --success: #6abf69; --warning: #e8a838; --danger: #e05252;
            --glass-bg: rgba(50, 32, 24, 0.65); --glass-border: rgba(196, 112, 58, 0.2);
        }

        /* ---- LIGHT MODE OVERRIDES ---- */
        [data-brightness="light"] {
            --bg-primary: #f0f4f8;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e2e8f0;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #94a3b8;
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(0, 0, 0, 0.08);
        }
        [data-brightness="light"] body { background: var(--bg-primary); }
        [data-brightness="light"] .calendar-day { background: var(--bg-secondary); }
        [data-brightness="light"] .form-input,
        [data-brightness="light"] .form-select { background: var(--bg-secondary); color: var(--text-primary); }
        [data-brightness="light"] .modal-content { background: var(--bg-secondary); }
        [data-brightness="light"] .table th { color: var(--text-secondary); }
        [data-brightness="light"] .journal-textarea { color: var(--text-primary); }
        [data-brightness="light"] .journal-write-card { background: var(--bg-secondary); }
        [data-brightness="light"] .about-stat-card { background: var(--bg-tertiary); }
        [data-brightness="light"] .year-month-card { background: var(--bg-secondary); }
        [data-brightness="light"] .toast { background: var(--glass-bg); }

        /* BASE STYLES */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--bg-tertiary); border-radius: var(--radius-full); }

        .bg-gradient {
            position: fixed; width: 600px; height: 600px; border-radius: 50%;
            filter: blur(120px); opacity: 0.15; pointer-events: none; z-index: 0;
        }
        .bg-gradient-1 {
            top: -200px; left: -200px; background: var(--accent-primary);
            animation: float 20s ease-in-out infinite;
        }
        .bg-gradient-2 {
            bottom: -200px; right: -200px; background: var(--accent-secondary);
            animation: float 25s ease-in-out infinite reverse;
        }
        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -50px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        /* ============================================================
           SIDEBAR v1.3.2 — Clean rewrite. No min-width hacks.
           The sidebar clips at 60px; items are centered via justify-content.
           ============================================================ */
        .sidebar {
            position: fixed; top: 0; left: 0;
            width: var(--sidebar-width); height: 100vh;
            background: var(--glass-bg); backdrop-filter: blur(20px);
            border-right: 1px solid var(--glass-border);
            display: flex; flex-direction: column;
            z-index: var(--z-sticky);
            transition: width var(--transition-base);
            overflow: hidden;
        }
        .sidebar.collapsed { width: var(--sidebar-collapsed); }

        /* HEADER */
        .sidebar-header {
            height: 64px; flex-shrink: 0;
            padding: 0 14px;
            display: flex; align-items: center; gap: 10px;
            border-bottom: 1px solid var(--glass-border);
        }
        .sidebar-logo-icon {
            font-size: 1.35rem; flex-shrink: 0;
            width: 34px; height: 34px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
        }
        .sidebar-logo-text {
            flex: 1; font-size: 1.15rem; font-weight: 700;
            white-space: nowrap; overflow: hidden;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            opacity: 1; transition: opacity var(--transition-base);
        }
        .sidebar.collapsed .sidebar-logo-text { opacity: 0; }
        .sidebar-toggle {
            flex-shrink: 0; width: 28px; height: 28px;
            display: flex; align-items: center; justify-content: center;
            background: var(--bg-tertiary); border: 1px solid var(--glass-border);
            border-radius: 7px; cursor: pointer; font-size: 0.65rem;
            color: var(--text-secondary);
            transition: all var(--transition-fast), opacity var(--transition-base);
        }
        .sidebar-toggle:hover { background: var(--accent-primary); color: white; border-color: var(--accent-primary); }
        .sidebar.collapsed .sidebar-toggle { opacity: 0; pointer-events: none; }

        /* NAV */
        .sidebar-nav {
            flex: 1; padding: 8px; overflow-y: auto; overflow-x: hidden;
        }

        /* Expand button — only visible when collapsed */
        .sidebar-expand-btn {
            display: none;
            width: 36px; height: 30px; margin: 0 auto 4px;
            align-items: center; justify-content: center;
            background: var(--bg-tertiary); border: 1px solid var(--glass-border);
            border-radius: 7px; cursor: pointer; font-size: 0.6rem;
            color: var(--text-secondary); transition: all var(--transition-fast);
        }
        .sidebar.collapsed .sidebar-expand-btn { display: flex; }
        .sidebar-expand-btn:hover { background: var(--accent-primary); color: white; border-color: var(--accent-primary); }

        /* NAV ITEMS */
        .nav-item {
            display: flex; align-items: center; gap: 12px;
            height: 40px; padding: 0 12px;
            border-radius: 9px; margin-bottom: 2px;
            color: var(--text-secondary); cursor: pointer;
            position: relative; overflow: visible;
            transition: background var(--transition-fast), color var(--transition-fast);
            white-space: nowrap;
        }
        .nav-item::before {
            content: ''; position: absolute; left: 0; top: 8px; bottom: 8px; width: 3px;
            background: var(--accent-primary); border-radius: 0 3px 3px 0;
            transform: scaleX(0); transform-origin: left;
            transition: transform var(--transition-fast);
        }
        .nav-item:hover { background: var(--bg-tertiary); color: var(--text-primary); }
        .nav-item.active { background: var(--bg-tertiary); color: var(--accent-primary); font-weight: 600; }
        .nav-item.active::before { transform: scaleX(1); }
        .nav-item-icon {
            font-size: 1.1rem; width: 22px; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
        }
        .nav-item-text {
            font-size: 0.875rem; font-weight: 500; white-space: nowrap;
            transition: opacity var(--transition-base);
        }

        /* COLLAPSED STATE */
        .sidebar.collapsed .nav-item {
            width: 40px; height: 40px;
            padding: 0; margin: 0 auto 2px;
            justify-content: center;
            border-radius: 9px;
        }
        .sidebar.collapsed .nav-item-text { opacity: 0; width: 0; overflow: hidden; }
        .sidebar.collapsed .nav-item-icon { font-size: 1.2rem; width: auto; display:flex; align-items:center; justify-content:center; }
        /* suppress active bar in collapsed — too narrow */
        .sidebar.collapsed .nav-item::before { display: none; }

        /* Tooltip on hover when collapsed */
        .sidebar.collapsed .nav-item::after {
            content: attr(data-tooltip);
            position: fixed;
            left: calc(var(--sidebar-collapsed) + 10px);
            background: var(--bg-secondary); color: var(--text-primary);
            padding: 5px 12px; border-radius: 8px;
            font-size: 0.8rem; font-weight: 600; white-space: nowrap;
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 16px rgba(0,0,0,0.25);
            opacity: 0; pointer-events: none;
            transition: opacity var(--transition-fast);
            z-index: 9999;
            transform: translateY(-50%);
        }
        .sidebar.collapsed .nav-item:hover::after { opacity: 1; }

        /* FOOTER */
        .sidebar-footer {
            padding: 8px 14px;
            border-top: 1px solid var(--glass-border);
            transition: opacity var(--transition-base);
        }
        .sidebar.collapsed .sidebar-footer { opacity: 0; pointer-events: none; }
        .sidebar-footer-hint {
            font-size: 0.7rem; color: var(--text-tertiary);
            text-align: center; letter-spacing: 0.04em;
        }

        /* MAIN CONTENT */
        .app-container { display: flex; min-height: 100vh; }
        .main-content {
            flex: 1; margin-left: var(--sidebar-width); padding: var(--space-xl);
            transition: margin-left var(--transition-base);
            position: relative; z-index: 1;
        }
        .main-content.sidebar-collapsed { margin-left: var(--sidebar-collapsed); }
        .page {
            display: none; max-width: 1400px; margin: 0 auto;
            animation: fadeInUp 0.5s ease;
        }
        .page.active { display: block; }
        .page-header { margin-bottom: var(--space-2xl); }
        .page-title {
            font-size: 2.5rem; font-weight: 700; margin-bottom: var(--space-sm);
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .page-subtitle { color: var(--text-secondary); font-size: 1.125rem; }

        /* COMPONENTS */
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-lg); margin-bottom: var(--space-2xl);
        }
        .stat-card {
            background: var(--glass-bg); backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border); border-radius: var(--radius-lg);
            padding: var(--space-lg); transition: all var(--transition-base);
            position: relative; overflow: hidden;
        }
        .stat-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 3px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transform: scaleX(0); transition: transform var(--transition-base);
        }
        .stat-card:hover {
            transform: translateY(-8px); border-color: var(--accent-primary);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        .stat-card:hover::before { transform: scaleX(1); }
        .stat-label {
            font-size: 0.875rem; font-weight: 500; text-transform: uppercase;
            letter-spacing: 0.05em; color: var(--text-secondary);
            margin-bottom: var(--space-sm);
        }
        .stat-value {
            font-size: 2.5rem; font-weight: 700; color: var(--accent-primary);
        }
        .btn {
            display: inline-flex; align-items: center; gap: var(--space-sm);
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: var(--bg-primary); border: none; border-radius: var(--radius-md);
            font-weight: 600; cursor: pointer; transition: all var(--transition-fast);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        .btn-secondary {
            background: var(--bg-tertiary); color: var(--text-primary);
            border: 1px solid var(--glass-border);
        }
        .btn-secondary:hover {
            background: var(--bg-secondary); border-color: var(--accent-primary);
        }
        .btn-danger {
            background: var(--danger); color: white;
        }
        .card {
            background: var(--glass-bg); backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border); border-radius: var(--radius-lg);
            padding: var(--space-lg); margin-bottom: var(--space-lg);
        }
        .form-group {
            display: flex; gap: var(--space-md); margin-bottom: var(--space-lg);
        }
        .form-input, .form-select {
            flex: 1; padding: 0.75rem 1rem;
            background: var(--bg-secondary); border: 1px solid var(--glass-border);
            border-radius: var(--radius-md); color: var(--text-primary);
            font-size: 1rem; transition: all var(--transition-fast);
        }
        .form-input:focus, .form-select:focus {
            outline: none; border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
        }

        /* CALENDAR */
        .calendar-controls {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: var(--space-lg);
        }
        .calendar-nav {
            display: flex; gap: var(--space-md); align-items: center;
        }
        .calendar-grid {
            display: grid; grid-template-columns: repeat(7, 1fr);
            gap: var(--space-sm);
        }
        .calendar-day-header {
            text-align: center; padding: var(--space-sm);
            color: var(--text-secondary); font-size: 0.875rem;
            font-weight: 600;
        }
        .calendar-day {
            aspect-ratio: 1; display: flex; align-items: center; justify-content: center;
            background: var(--bg-secondary); border: 1px solid var(--glass-border);
            border-radius: var(--radius-sm); cursor: pointer;
            transition: all var(--transition-fast); position: relative;
        }
        .calendar-day:hover {
            transform: scale(1.05); border-color: var(--accent-primary);
        }
        .calendar-day.empty { background: transparent; border: none; cursor: default; }
        .calendar-day.empty:hover { transform: none; }
        .calendar-day.today {
            border-color: var(--accent-primary); border-width: 2px;
        }
        .calendar-day-number {
            font-size: 0.875rem; font-weight: 500;
        }
        .calendar-day[data-completion="0"] { background: var(--bg-secondary); }
        .calendar-day[data-completion="1"] { background: rgba(0, 212, 255, 0.2); }
        .calendar-day[data-completion="2"] { background: rgba(0, 212, 255, 0.4); }
        .calendar-day[data-completion="3"] { background: rgba(0, 212, 255, 0.6); }
        .calendar-day[data-completion="4"] { background: rgba(0, 212, 255, 0.8); }
        .calendar-day[data-completion="5"] {
            background: var(--accent-primary);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
        }

        /* HABIT ITEM */
        .habit-item {
            background: var(--glass-bg); backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border); border-radius: var(--radius-lg);
            padding: var(--space-lg); display: flex; justify-content: space-between;
            align-items: center; margin-bottom: var(--space-md);
            transition: all var(--transition-base); position: relative;
        }
        .habit-item::before {
            content: ''; position: absolute; left: 0; top: 0; height: 100%; width: 4px;
            background: var(--accent-primary); transform: scaleY(0);
            transition: transform var(--transition-fast);
        }
        .habit-item:hover {
            transform: translateX(8px); border-color: var(--accent-primary);
        }
        .habit-item:hover::before { transform: scaleY(1); }
        .habit-item.completed { opacity: 0.7; }
        .habit-content {
            display: flex; align-items: center; gap: var(--space-md);
        }
        .habit-checkbox {
            width: 24px; height: 24px; border: 2px solid var(--accent-primary);
            border-radius: var(--radius-sm); cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: all var(--transition-fast);
        }
        .habit-checkbox:hover { background: rgba(0, 212, 255, 0.1); }
        .habit-item.completed .habit-checkbox {
            background: var(--success); border-color: var(--success);
        }
        .habit-item.completed .habit-checkbox::after {
            content: '✓'; color: white; font-weight: bold;
        }
        .habit-name { font-size: 1.125rem; font-weight: 500; }
        .habit-item.completed .habit-name {
            text-decoration: line-through; color: var(--text-secondary);
        }
        .habit-streak {
            display: flex; align-items: center; gap: var(--space-sm);
            color: var(--warning); font-weight: 600;
        }

        /* TOAST */
        .toast-container {
            position: fixed; top: var(--space-xl); right: var(--space-xl);
            z-index: var(--z-toast); display: flex; flex-direction: column;
            gap: var(--space-md);
        }
        .toast {
            background: var(--glass-bg); backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-radius: var(--radius-md);
            padding: var(--space-md) var(--space-lg);
            display: flex; align-items: center; gap: var(--space-md);
            min-width: 300px; animation: slideIn 0.3s ease;
        }
        .toast-icon { font-size: 1.5rem; }
        .toast.success { border-color: var(--success); }
        .toast.success .toast-icon { color: var(--success); }
        .toast.info { border-color: var(--accent-primary); }
        .toast.info .toast-icon { color: var(--accent-primary); }

        /* MODAL */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10, 14, 39, 0.9); backdrop-filter: blur(10px);
            z-index: var(--z-modal); align-items: center; justify-content: center;
        }
        .modal.active { display: flex; animation: fadeIn 0.3s ease; }
        .modal-content {
            background: var(--bg-secondary); border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg); padding: var(--space-xl);
            max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;
            animation: scaleIn 0.3s ease;
        }
        .modal-header { margin-bottom: var(--space-lg); }
        .modal-title { font-size: 1.5rem; font-weight: 600; }
        .modal-body { margin-bottom: var(--space-lg); }
        .modal-footer {
            display: flex; gap: var(--space-md); justify-content: flex-end;
        }

        /* SETTINGS */
        .settings-section {
            margin-bottom: var(--space-2xl);
        }
        .settings-section-title {
            font-size: 1.25rem; font-weight: 600;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-sm);
            border-bottom: 2px solid var(--glass-border);
        }
        .settings-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: var(--space-md) 0;
            border-bottom: 1px solid var(--glass-border);
        }
        .settings-label {
            font-weight: 500;
        }
        .settings-description {
            font-size: 0.875rem; color: var(--text-secondary);
        }
        .danger-zone {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
        }

        /* ANIMATIONS */
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* ============ ASCEND ANIMATION SYSTEM v1.3.5 ============ */

        /* Page entrance — every page fades + slides up when activated */
        @keyframes pageEnter {
            from { opacity: 0; transform: translateY(16px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        .page.active {
            animation: pageEnter 0.35s cubic-bezier(0.22, 1, 0.36, 1) both;
        }

        /* Staggered card children */
        @keyframes cardPop {
            from { opacity: 0; transform: translateY(20px) scale(0.97); }
            to   { opacity: 1; transform: translateY(0) scale(1); }
        }
        .stat-card, .goal-card, .insight-card, .card,
        .journal-entry-card, .habit-item, .year-month-card {
            animation: cardPop 0.4s cubic-bezier(0.22, 1, 0.36, 1) both;
        }
        /* Stagger delays for grids */
        .stat-card:nth-child(1), .goal-card:nth-child(1), .insight-card:nth-child(1) { animation-delay: 0.05s; }
        .stat-card:nth-child(2), .goal-card:nth-child(2), .insight-card:nth-child(2) { animation-delay: 0.10s; }
        .stat-card:nth-child(3), .goal-card:nth-child(3), .insight-card:nth-child(3) { animation-delay: 0.15s; }
        .stat-card:nth-child(4), .goal-card:nth-child(4), .insight-card:nth-child(4) { animation-delay: 0.20s; }
        .stat-card:nth-child(5), .goal-card:nth-child(5) { animation-delay: 0.25s; }
        .stat-card:nth-child(6), .goal-card:nth-child(6) { animation-delay: 0.30s; }

        /* Habit list stagger */
        .habit-item:nth-child(1) { animation-delay: 0.04s; }
        .habit-item:nth-child(2) { animation-delay: 0.08s; }
        .habit-item:nth-child(3) { animation-delay: 0.12s; }
        .habit-item:nth-child(4) { animation-delay: 0.16s; }
        .habit-item:nth-child(5) { animation-delay: 0.20s; }
        .habit-item:nth-child(6) { animation-delay: 0.24s; }

        /* Progress bar fill animation */
        @keyframes progressFill {
            from { width: 0%; }
        }
        .goal-progress-fill, .widget-goal-bar-fill {
            animation: progressFill 0.8s cubic-bezier(0.22, 1, 0.36, 1) both;
            animation-delay: 0.3s;
        }

        /* Streak / stat number pulse on update */
        @keyframes statPulse {
            0%   { transform: scale(1); }
            40%  { transform: scale(1.15); }
            100% { transform: scale(1); }
        }
        .stat-value.updated {
            animation: statPulse 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* Milestone check bounce */
        @keyframes checkBounce {
            0%   { transform: scale(0); }
            60%  { transform: scale(1.25); }
            100% { transform: scale(1); }
        }
        .milestone-check.just-checked {
            animation: checkBounce 0.35s cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* Habit completion ripple */
        @keyframes completionRipple {
            from { box-shadow: 0 0 0 0 rgba(var(--accent-rgb, 0,212,255), 0.5); }
            to   { box-shadow: 0 0 0 14px rgba(var(--accent-rgb, 0,212,255), 0); }
        }
        .habit-item.just-completed {
            animation: completionRipple 0.5s ease-out;
        }

        /* Toast slide-in from bottom */
        @keyframes toastIn {
            from { transform: translateY(80px) scale(0.9); opacity: 0; }
            to   { transform: translateY(0) scale(1); opacity: 1; }
        }
        @keyframes toastOut {
            from { transform: translateY(0) scale(1); opacity: 1; }
            to   { transform: translateY(80px) scale(0.9); opacity: 0; }
        }
        .toast { animation: toastIn 0.35s cubic-bezier(0.22, 1, 0.36, 1) both; }
        .toast.hiding { animation: toastOut 0.25s ease-in both; }

        /* Nav item hover bounce */
        .nav-item {
            transition: background var(--transition-fast), color var(--transition-fast),
                        transform var(--transition-fast);
        }
        .nav-item:hover { transform: translateX(3px); }
        .sidebar.collapsed .nav-item:hover { transform: scale(1.08); }

        /* Button press feel */
        .btn { transition: all var(--transition-fast); }
        .btn:active { transform: scale(0.96); }

        /* Goal card hover lift (more pronounced) */
        .goal-card {
            transition: transform 0.25s cubic-bezier(0.22, 1, 0.36, 1),
                        box-shadow 0.25s ease,
                        border-color var(--transition-fast);
        }
        .goal-card:hover {
            transform: translateY(-5px) scale(1.01);
            box-shadow: 0 16px 40px rgba(0,0,0,0.25);
        }

        /* Insight card hover */
        .insight-card {
            transition: transform 0.25s cubic-bezier(0.22, 1, 0.36, 1),
                        box-shadow 0.25s ease,
                        border-color var(--transition-fast);
        }

        /* Settings theme card hover pulse */
        .settings-theme-card {
            transition: transform 0.2s cubic-bezier(0.22,1,0.36,1), border-color var(--transition-fast);
        }
        .settings-theme-card:hover { transform: scale(1.04); }
        .settings-theme-card.active { transform: scale(1.06); }

        /* Journal textarea focus glow */
        .journal-textarea {
            transition: border-color var(--transition-fast),
                        box-shadow var(--transition-fast);
        }
        .journal-textarea:focus {
            box-shadow: 0 0 0 3px rgba(var(--accent-rgb, 0,212,255), 0.15);
        }

        /* Page title entrance */
        .page-title {
            animation: fadeInUp 0.4s cubic-bezier(0.22,1,0.36,1) both;
        }
        .page-subtitle {
            animation: fadeInUp 0.4s cubic-bezier(0.22,1,0.36,1) 0.07s both;
        }

        /* Reduce motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* MOBILE */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.mobile-open { transform: translateX(0); }
            .main-content { margin-left: 0; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .page-title { font-size: 2rem; }
            .calendar-grid { gap: 2px; }
            .calendar-day { font-size: 0.75rem; }
        }

        .mobile-menu-btn {
            display: none; position: fixed; bottom: var(--space-lg); right: var(--space-lg);
            width: 56px; height: 56px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: var(--radius-full); align-items: center; justify-content: center;
            font-size: 1.5rem; cursor: pointer; z-index: 999;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        @media (max-width: 768px) {
            .mobile-menu-btn { display: flex; }
        }

        #confetti-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 999;
        }

        .empty-state {
            text-align: center; padding: var(--space-2xl);
            color: var(--text-secondary);
        }
        .empty-state-icon {
            font-size: 4rem; margin-bottom: var(--space-lg); opacity: 0.5;
        }

        .chart-container {
            position: relative; height: 300px; margin-bottom: var(--space-xl);
        }

        .table {
            width: 100%; border-collapse: collapse;
        }
        .table th, .table td {
            padding: var(--space-md); text-align: left;
            border-bottom: 1px solid var(--glass-border);
        }
        .table th {
            font-weight: 600; color: var(--text-secondary);
            text-transform: uppercase; font-size: 0.875rem;
        }

        /* ============================================
           V1.2.2 NEW STYLES
           ============================================ */

        /* CALENDAR: View toggle buttons */
        .cal-view-toggle {
            display: flex; gap: var(--space-sm);
        }
        .cal-view-btn {
            padding: 0.4rem 1rem; border-radius: var(--radius-md);
            background: var(--bg-secondary); border: 1px solid var(--glass-border);
            color: var(--text-secondary); cursor: pointer; font-weight: 600;
            font-size: 0.875rem; transition: all var(--transition-fast);
        }
        .cal-view-btn.active, .cal-view-btn:hover {
            background: var(--accent-primary); color: var(--bg-primary);
            border-color: var(--accent-primary);
        }

        /* CALENDAR: Today badge */
        .calendar-day.today .today-badge {
            position: absolute; top: 2px; right: 2px;
            width: 6px; height: 6px; background: var(--accent-primary);
            border-radius: 50%; box-shadow: 0 0 6px var(--accent-primary);
        }
        .calendar-day:hover { box-shadow: 0 0 0 2px var(--accent-primary) inset; }

        /* CALENDAR: Year view grid */
        .year-view {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-lg);
        }
        @media (max-width: 900px) { .year-view { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 600px) { .year-view { grid-template-columns: repeat(2, 1fr); } }

        .year-month-card {
            background: var(--bg-secondary); border: 1px solid var(--glass-border);
            border-radius: var(--radius-md); padding: var(--space-md);
            cursor: pointer; transition: all var(--transition-fast);
        }
        .year-month-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }
        .year-month-name {
            font-size: 0.875rem; font-weight: 700; color: var(--accent-primary);
            margin-bottom: var(--space-sm); text-align: center;
        }
        .year-mini-grid {
            display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px;
        }
        .year-mini-day {
            aspect-ratio: 1; border-radius: 2px;
            background: var(--bg-tertiary);
        }
        .year-mini-day.has-data-1 { background: rgba(0,212,255,0.2); }
        .year-mini-day.has-data-2 { background: rgba(0,212,255,0.45); }
        .year-mini-day.has-data-3 { background: rgba(0,212,255,0.7); }
        .year-mini-day.has-data-4 { background: var(--accent-primary); }
        .year-mini-day.empty-day { background: transparent; }
        .year-month-avg {
            text-align: center; font-size: 0.75rem; color: var(--text-secondary);
            margin-top: var(--space-sm);
        }

        /* CALENDAR: Day modal navigation arrows */
        .modal-day-nav {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: var(--space-md);
        }
        .modal-day-nav h3 { margin: 0; font-size: 1.25rem; }
        .nav-arrow {
            width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;
            background: var(--bg-tertiary); border: 1px solid var(--glass-border);
            border-radius: var(--radius-sm); cursor: pointer; transition: all var(--transition-fast);
            font-size: 1rem; color: var(--text-primary); flex-shrink: 0;
        }
        .nav-arrow:hover { background: var(--accent-primary); color: var(--bg-primary); border-color: var(--accent-primary); }

        /* ANALYTICS: Insights panel */
        .insights-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }
        @media (max-width: 700px) { .insights-grid { grid-template-columns: 1fr; } }

        .insight-card {
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg); padding: var(--space-lg);
            position: relative; overflow: hidden; transition: all var(--transition-base);
        }
        .insight-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
        }
        .insight-card:hover { transform: translateY(-4px); border-color: var(--accent-primary); }
        .insight-icon { font-size: 1.75rem; margin-bottom: var(--space-sm); }
        .insight-label {
            font-size: 0.75rem; font-weight: 600; text-transform: uppercase;
            letter-spacing: 0.08em; color: var(--text-secondary); margin-bottom: var(--space-xs);
        }
        .insight-value {
            font-size: 1.5rem; font-weight: 700; color: var(--accent-primary);
            margin-bottom: var(--space-xs);
        }
        .insight-sub { font-size: 0.8rem; color: var(--text-secondary); }
        .momentum-up { color: #10b981; }
        .momentum-stable { color: var(--warning); }
        .momentum-down { color: var(--danger); }

        /* ANALYTICS: Day of week chart */
        .dow-chart-container {
            position: relative; height: 200px;
        }

        /* SETTINGS: Habit templates */
        .templates-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: var(--space-md);
        }
        .template-card {
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg); padding: var(--space-lg);
            cursor: pointer; transition: all var(--transition-base);
            position: relative; overflow: hidden;
        }
        .template-card::before {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            opacity: 0; transition: opacity var(--transition-fast);
        }
        .template-card:hover { transform: translateY(-4px); border-color: var(--accent-primary); }
        .template-card:hover::before { opacity: 0.08; }
        .template-label { font-size: 2rem; margin-bottom: var(--space-sm); position: relative; }
        .template-name {
            font-size: 1rem; font-weight: 700; margin-bottom: var(--space-xs); position: relative;
        }
        .template-habits {
            font-size: 0.8rem; color: var(--text-secondary); position: relative; line-height: 1.6;
        }

        /* SETTINGS: Enhanced about stats */
        .about-stats-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }
        .about-stat-card {
            background: var(--bg-secondary); border: 1px solid var(--glass-border);
            border-radius: var(--radius-md); padding: var(--space-md); text-align: center;
        }
        .about-stat-value {
            font-size: 1.75rem; font-weight: 700; color: var(--accent-primary);
            display: block;
        }
        .about-stat-label {
            font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* COUNT-UP animation helper */
        @keyframes countUp {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .count-up { animation: countUp 0.4s ease forwards; }

        /* EMPTY STATE with CTA */
        .empty-state-cta {
            margin-top: var(--space-lg);
        }

        /* ============================================
           V1.3 — JOURNAL STYLES
           ============================================ */

        /* Journal page layout */
        .journal-layout {
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: var(--space-xl);
            align-items: start;
        }
        @media (max-width: 1100px) {
            .journal-layout { grid-template-columns: 1fr; }
            .journal-write-panel { order: -1; }
        }

        /* Write panel */
        .journal-write-panel {
            position: sticky; top: var(--space-xl);
        }
        .journal-write-card {
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg); overflow: hidden;
        }
        .journal-write-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--glass-border);
            display: flex; align-items: center; justify-content: space-between;
        }
        .journal-write-date {
            font-size: 1rem; font-weight: 700; color: var(--accent-primary);
        }
        .journal-write-stats {
            font-size: 0.8rem; color: var(--text-secondary);
        }
        .journal-prompt {
            padding: var(--space-md) var(--space-lg);
            background: rgba(0,0,0,0.2);
            border-bottom: 1px solid var(--glass-border);
            font-size: 0.85rem; color: var(--text-secondary);
            font-style: italic; line-height: 1.5;
            display: flex; align-items: flex-start; gap: var(--space-sm);
        }
        .journal-prompt-icon { font-size: 1rem; flex-shrink: 0; margin-top: 1px; }
        .journal-textarea {
            width: 100%; min-height: 260px; padding: var(--space-lg);
            background: transparent; border: none; resize: vertical;
            color: var(--text-primary); font-size: 1rem; line-height: 1.7;
            font-family: inherit; outline: none;
        }
        .journal-textarea::placeholder { color: var(--text-tertiary); font-style: italic; }
        .journal-write-footer {
            padding: var(--space-sm) var(--space-lg);
            border-top: 1px solid var(--glass-border);
            display: flex; align-items: center; justify-content: space-between;
        }
        .journal-save-status {
            font-size: 0.75rem; color: var(--text-tertiary);
            transition: color var(--transition-fast);
        }
        .journal-save-status.saved { color: var(--success); }
        .journal-word-count { font-size: 0.75rem; color: var(--text-tertiary); }

        /* Journal entry feed */
        .journal-feed-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: var(--space-lg);
        }
        .journal-feed-title { font-size: 1.125rem; font-weight: 700; }
        .journal-entry-count {
            font-size: 0.8rem; color: var(--text-secondary);
            background: var(--bg-tertiary); padding: 2px 10px;
            border-radius: var(--radius-full);
        }
        .journal-entry-card {
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg); padding: var(--space-lg);
            margin-bottom: var(--space-md); cursor: pointer;
            transition: all var(--transition-base); position: relative;
            overflow: hidden;
        }
        .journal-entry-card::before {
            content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px;
            background: linear-gradient(180deg, var(--accent-primary), var(--accent-secondary));
            transform: scaleY(0); transition: transform var(--transition-fast);
            transform-origin: top;
        }
        .journal-entry-card:hover { border-color: var(--accent-primary); transform: translateX(4px); }
        .journal-entry-card:hover::before { transform: scaleY(1); }
        .journal-entry-card.active-entry { border-color: var(--accent-primary); }
        .journal-entry-card.active-entry::before { transform: scaleY(1); }
        .journal-entry-meta {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: var(--space-sm);
        }
        .journal-entry-date {
            font-size: 0.875rem; font-weight: 700; color: var(--accent-primary);
        }
        .journal-entry-badge {
            font-size: 0.75rem; padding: 2px 8px; border-radius: var(--radius-full);
            background: var(--bg-tertiary); color: var(--text-secondary);
        }
        .journal-entry-badge.perfect { background: rgba(16,185,129,0.2); color: var(--success); }
        .journal-entry-preview {
            font-size: 0.875rem; color: var(--text-secondary);
            line-height: 1.5; display: -webkit-box;
            -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
        }
        .journal-entry-footer {
            display: flex; align-items: center; gap: var(--space-md);
            margin-top: var(--space-sm); font-size: 0.75rem; color: var(--text-tertiary);
        }

        /* Calendar journal dot */
        .journal-dot {
            position: absolute; bottom: 3px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; background: var(--warning);
            border-radius: 50%;
        }

        /* Journal stats row */
        .journal-stats-row {
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md); margin-bottom: var(--space-xl);
        }
        .journal-stat-pill {
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: var(--radius-md); padding: var(--space-md);
            text-align: center;
        }
        .journal-stat-pill .stat-val {
            font-size: 1.5rem; font-weight: 700; color: var(--accent-primary); display: block;
        }
        .journal-stat-pill .stat-lbl {
            font-size: 0.7rem; color: var(--text-secondary);
            text-transform: uppercase; letter-spacing: 0.05em;
        }

        /* Empty journal state */
        .journal-empty {
            text-align: center; padding: var(--space-2xl) var(--space-lg);
            color: var(--text-secondary);
        }
        .journal-empty-icon { font-size: 3.5rem; margin-bottom: var(--space-md); opacity: 0.5; }

        /* LIGHT/DARK TOGGLE */
        .brightness-toggle-row {
            display: flex; align-items: center; justify-content: space-between;
            padding: var(--space-lg);
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg); margin-bottom: var(--space-lg);
        }
        .brightness-toggle-info { display: flex; flex-direction: column; gap: 4px; }
        .brightness-toggle-label { font-weight: 600; font-size: 0.95rem; }
        .brightness-toggle-sub { font-size: 0.8rem; color: var(--text-secondary); }
        .brightness-switch {
            position: relative; width: 80px; height: 36px; flex-shrink: 0;
            background: var(--bg-tertiary); border-radius: 18px;
            border: 1px solid var(--glass-border);
            cursor: pointer; transition: background var(--transition-base);
            display: flex; align-items: center; overflow: hidden;
        }
        .brightness-switch.light { background: linear-gradient(135deg, #fbbf24, #f59e0b); border-color: #f59e0b; }
        .brightness-switch-knob {
            position: absolute; left: 4px; width: 28px; height: 28px;
            background: white; border-radius: 50%;
            transition: transform var(--transition-base);
            display: flex; align-items: center; justify-content: center;
            font-size: 0.85rem; box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .brightness-switch.light .brightness-switch-knob { transform: translateX(44px); }
        .brightness-switch-icons {
            width: 100%; display: flex; justify-content: space-between;
            padding: 0 8px; font-size: 0.8rem; pointer-events: none;
        }

        /* Settings version badge */
        .version-badge {
            display: inline-flex; align-items: center; gap: 6px;
            background: var(--bg-tertiary); border: 1px solid var(--glass-border);
            padding: 4px 12px; border-radius: var(--radius-full);
            font-size: 0.8rem; color: var(--text-secondary);
        }
        .settings-theme-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: var(--space-md);
        }
        .settings-theme-card {
            border-radius: var(--radius-md); cursor: pointer;
            border: 2px solid var(--glass-border); transition: all var(--transition-fast);
            overflow: hidden;
        }
        .settings-theme-card:hover { transform: translateY(-3px); border-color: rgba(255,255,255,0.4); }
        .settings-theme-card.active {
            border-color: white;
            box-shadow: 0 0 16px rgba(255,255,255,0.2);
        }
        .settings-theme-swatch { height: 48px; width: 100%; }
        .settings-theme-label {
            display: flex; align-items: center; justify-content: space-between;
            padding: 6px 10px; background: var(--bg-secondary);
        }
        .settings-theme-name { font-size: 0.8rem; font-weight: 600; }
        .settings-theme-check {
            font-size: 0.7rem; color: var(--success);
            opacity: 0; transition: opacity 0.2s;
        }
        .settings-theme-card.active .settings-theme-check { opacity: 1; }

        /* Theme swatch gradients */
        .st-ocean .settings-theme-swatch { background: linear-gradient(135deg, #00d4ff, #0095ff); }
        .st-sakura .settings-theme-swatch { background: linear-gradient(135deg, #ff6b9d, #c084fc); }
        .st-cyber .settings-theme-swatch { background: linear-gradient(135deg, #00ff88, #00cc6a); }
        .st-coral .settings-theme-swatch { background: linear-gradient(135deg, #ff6b6b, #ff8787); }
        .st-emerald .settings-theme-swatch { background: linear-gradient(135deg, #10b981, #059669); }
        .st-lavender .settings-theme-swatch { background: linear-gradient(135deg, #a78bfa, #8b5cf6); }
        .st-crimson .settings-theme-swatch { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .st-gold .settings-theme-swatch { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
        .st-arctic .settings-theme-swatch { background: linear-gradient(135deg, #38bdf8, #0ea5e9); }
        .st-midnight .settings-theme-swatch { background: linear-gradient(135deg, #818cf8, #6366f1); }
        .st-nature  .settings-theme-swatch { background: linear-gradient(135deg, #5a9e6f, #3d7a52); }
        .st-mono    .settings-theme-swatch { background: linear-gradient(135deg, #e8e8e8, #888888); }
        .st-earth   .settings-theme-swatch { background: linear-gradient(135deg, #c4703a, #a85a2a); }

        /* ============================================
           V1.3.4 — GOALS & MILESTONES STYLES
           ============================================ */
        .area-health        { --area-color: #10b981; --area-bg: rgba(16,185,129,0.12); }
        .area-mind          { --area-color: #8b5cf6; --area-bg: rgba(139,92,246,0.12); }
        .area-finance       { --area-color: #f59e0b; --area-bg: rgba(245,158,11,0.12); }
        .area-career        { --area-color: #3b82f6; --area-bg: rgba(59,130,246,0.12); }
        .area-relationships { --area-color: #ec4899; --area-bg: rgba(236,72,153,0.12); }
        .area-creative      { --area-color: #f97316; --area-bg: rgba(249,115,22,0.12); }

        .goals-top-row { display:flex; align-items:center; justify-content:space-between; margin-bottom:var(--space-xl); }
        .goals-stats-strip { display:grid; grid-template-columns:repeat(4,1fr); gap:var(--space-md); margin-bottom:var(--space-xl); }
        @media (max-width:768px) { .goals-stats-strip { grid-template-columns:repeat(2,1fr); } }
        .gstat-pill { background:var(--glass-bg); border:1px solid var(--glass-border); border-radius:var(--radius-md); padding:var(--space-md); text-align:center; }
        .gstat-pill .gv { display:block; font-size:1.75rem; font-weight:800; color:var(--accent-primary); line-height:1.1; }
        .gstat-pill .gl { font-size:0.7rem; color:var(--text-secondary); text-transform:uppercase; letter-spacing:0.06em; }

        .goals-filter-tabs { display:flex; gap:var(--space-sm); margin-bottom:var(--space-lg); flex-wrap:wrap; }
        .goals-filter-tab { padding:5px 14px; border-radius:20px; font-size:0.8rem; font-weight:600; background:var(--bg-tertiary); border:1px solid var(--glass-border); color:var(--text-secondary); cursor:pointer; transition:all var(--transition-fast); }
        .goals-filter-tab.active,.goals-filter-tab:hover { background:var(--accent-primary); color:var(--bg-primary); border-color:var(--accent-primary); }

        .goals-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:var(--space-lg); }

        .goal-card { background:var(--glass-bg); border:1px solid var(--glass-border); border-radius:var(--radius-lg); overflow:hidden; transition:all var(--transition-base); display:flex; flex-direction:column; }
        .goal-card:hover { transform:translateY(-3px); box-shadow:0 12px 32px rgba(0,0,0,0.2); }
        .goal-card-accent { height:4px; width:100%; background:var(--area-color,var(--accent-primary)); }
        .goal-card-body { padding:var(--space-lg); flex:1; }
        .goal-card-header { display:flex; align-items:flex-start; justify-content:space-between; margin-bottom:var(--space-md); }
        .goal-area-badge { font-size:0.7rem; font-weight:700; padding:3px 10px; border-radius:20px; letter-spacing:0.05em; text-transform:uppercase; background:var(--area-bg,rgba(0,0,0,0.2)); color:var(--area-color,var(--accent-primary)); }
        .goal-card-menu { display:flex; gap:6px; }
        .goal-card-menu button { background:none; border:none; cursor:pointer; color:var(--text-tertiary); font-size:0.8rem; padding:2px 6px; border-radius:4px; transition:all var(--transition-fast); }
        .goal-card-menu button:hover { background:var(--bg-tertiary); color:var(--text-primary); }
        .goal-card-title { font-size:1.05rem; font-weight:700; color:var(--text-primary); margin-bottom:var(--space-sm); line-height:1.3; }
        .goal-card-meta { display:flex; gap:var(--space-md); margin-bottom:var(--space-md); font-size:0.78rem; color:var(--text-secondary); flex-wrap:wrap; }
        .goal-meta-item { display:flex; align-items:center; gap:4px; }

        .goal-progress-row { display:flex; align-items:center; justify-content:space-between; margin-bottom:6px; }
        .goal-progress-label { font-size:0.72rem; color:var(--text-secondary); font-weight:600; text-transform:uppercase; letter-spacing:0.04em; }
        .goal-progress-pct { font-size:0.9rem; font-weight:800; color:var(--area-color,var(--accent-primary)); }
        .goal-progress-bar { height:8px; background:var(--bg-tertiary); border-radius:4px; overflow:hidden; margin-bottom:var(--space-md); }
        .goal-progress-fill { height:100%; border-radius:4px; background:var(--area-color,var(--accent-primary)); transition:width 0.6s ease; }

        .goal-milestones { margin-bottom:var(--space-sm); }
        .goal-milestones-title { font-size:0.7rem; font-weight:700; text-transform:uppercase; letter-spacing:0.06em; color:var(--text-secondary); margin-bottom:var(--space-sm); }
        .milestone-item { display:flex; align-items:center; gap:8px; padding:4px 0; cursor:pointer; }
        .milestone-check { width:18px; height:18px; border-radius:50%; flex-shrink:0; border:2px solid var(--glass-border); display:flex; align-items:center; justify-content:center; font-size:0.6rem; transition:all var(--transition-fast); background:transparent; }
        .milestone-item.done .milestone-check { background:var(--area-color,var(--accent-primary)); border-color:var(--area-color,var(--accent-primary)); color:white; }
        .milestone-label { font-size:0.82rem; color:var(--text-secondary); transition:color var(--transition-fast); flex:1; }
        .milestone-item.done .milestone-label { text-decoration:line-through; opacity:0.55; }
        .milestone-date { font-size:0.68rem; color:var(--text-tertiary); }

        .goal-habits-row { display:flex; gap:6px; flex-wrap:wrap; margin-top:var(--space-sm); padding-top:var(--space-sm); border-top:1px solid var(--glass-border); }
        .goal-habit-chip { font-size:0.72rem; padding:3px 9px; border-radius:12px; background:var(--bg-tertiary); color:var(--text-secondary); border:1px solid var(--glass-border); }
        .goal-achieved-banner { background:linear-gradient(135deg,rgba(16,185,129,0.15),rgba(16,185,129,0.05)); border-top:1px solid rgba(16,185,129,0.3); padding:var(--space-sm) var(--space-md); font-size:0.8rem; color:var(--success); font-weight:700; text-align:center; }

        .goal-form-section { margin-bottom:var(--space-lg); }
        .goal-form-label { display:block; font-size:0.78rem; font-weight:700; text-transform:uppercase; letter-spacing:0.06em; color:var(--text-secondary); margin-bottom:var(--space-sm); }
        .area-picker { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; }
        .area-option { padding:10px 6px; border-radius:var(--radius-sm); border:2px solid var(--glass-border); cursor:pointer; text-align:center; font-size:0.78rem; font-weight:700; transition:all var(--transition-fast); background:var(--bg-secondary); }
        .area-option:hover { border-color:var(--accent-primary); }
        .area-option.selected { border-color:var(--area-color); background:var(--area-bg); color:var(--area-color); }
        .area-option-icon { display:flex; align-items:center; justify-content:center; margin-bottom:6px; }

        .milestone-add-row { display:flex; gap:var(--space-sm); margin-top:var(--space-sm); }
        .milestone-add-row input { flex:1; }
        .milestone-input-list { list-style:none; margin-top:var(--space-sm); }
        .milestone-input-item { display:flex; align-items:center; justify-content:space-between; padding:5px 8px; background:var(--bg-tertiary); border-radius:var(--radius-sm); margin-bottom:4px; font-size:0.82rem; color:var(--text-primary); }
        .milestone-input-item button { background:none; border:none; cursor:pointer; color:var(--text-tertiary); }

        .habit-link-grid { display:grid; grid-template-columns:1fr 1fr; gap:6px; }
        .habit-link-option { display:flex; align-items:center; gap:8px; padding:7px 10px; border-radius:var(--radius-sm); border:2px solid var(--glass-border); cursor:pointer; background:var(--bg-secondary); font-size:0.82rem; transition:all var(--transition-fast); }
        .habit-link-option:hover { border-color:var(--accent-primary); }
        .habit-link-option.selected { border-color:var(--accent-primary); background:rgba(0,212,255,0.08); }

        .dashboard-goals-widget { background:var(--glass-bg); border:1px solid var(--glass-border); border-radius:var(--radius-lg); padding:var(--space-lg); margin-top:var(--space-xl); }
        .widget-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:var(--space-lg); }
        .widget-title { font-size:1rem; font-weight:700; }
        .widget-link { font-size:0.8rem; color:var(--accent-primary); cursor:pointer; font-weight:600; }
        .widget-goal-row { display:flex; align-items:center; gap:var(--space-md); padding:var(--space-sm) 0; border-bottom:1px solid var(--glass-border); }
        .widget-goal-row:last-child { border-bottom:none; }
        .widget-goal-dot { width:10px; height:10px; border-radius:50%; flex-shrink:0; background:var(--area-color,var(--accent-primary)); }
        .widget-goal-name { flex:1; font-size:0.875rem; font-weight:500; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
        .widget-goal-bar { width:80px; height:6px; background:var(--bg-tertiary); border-radius:3px; overflow:hidden; flex-shrink:0; }
        .widget-goal-bar-fill { height:100%; border-radius:3px; background:var(--area-color,var(--accent-primary)); transition:width 0.5s; }
        .widget-goal-pct { font-size:0.78rem; font-weight:700; color:var(--accent-primary); min-width:32px; text-align:right; }

        .goals-empty { grid-column:1/-1; text-align:center; padding:var(--space-2xl) var(--space-lg); color:var(--text-secondary); }
        .goals-empty-icon { font-size:3.5rem; margin-bottom:var(--space-md); opacity:0.4; }

        /* ============================================
           SOCIAL HUB — v1.3.9
           ============================================ */

        /* Profile card */
        .social-profile-card {
            display: flex; align-items: center; gap: var(--space-lg);
            flex-wrap: wrap;
            background: var(--glass-bg); backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: var(--space-lg) var(--space-xl);
            margin-bottom: var(--space-lg);
            animation: cardPop 0.4s cubic-bezier(0.22,1,0.36,1) both;
        }
        .social-profile-left { display: flex; align-items: center; gap: var(--space-md); flex: 1; min-width: 180px; }
        .social-profile-info { display: flex; flex-direction: column; }
        .social-profile-name { font-size: 1.1rem; font-weight: 700; color: var(--text-primary); }
        .social-profile-joined { font-size: 0.8rem; color: var(--text-secondary); margin-top: 2px; }
        .social-profile-stats { display: flex; gap: var(--space-sm); flex-wrap: wrap; }
        .social-stat-pill {
            display: flex; flex-direction: column; align-items: center;
            background: var(--bg-tertiary); border-radius: var(--radius-md);
            padding: 6px 14px; min-width: 60px;
        }
        .social-stat-val { font-size: 1.1rem; font-weight: 800; color: var(--accent-primary); line-height: 1.2; }
        .social-stat-lbl { font-size: 0.7rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; }
        .social-code-block { display: flex; flex-direction: column; gap: 4px; margin-left: auto; }
        .social-code-label { font-size: 0.72rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; }
        .social-code-display { display: flex; align-items: center; gap: 8px; }
        .social-code-value {
            font-family: 'Courier New', monospace; font-size: 1.25rem; font-weight: 700;
            color: var(--accent-primary); letter-spacing: 0.1em;
        }
        .social-copy-btn {
            background: var(--bg-tertiary); border: 1px solid var(--glass-border);
            color: var(--text-secondary); border-radius: var(--radius-sm);
            padding: 4px 8px; cursor: pointer; transition: all var(--transition-fast);
            display: flex; align-items: center;
        }
        .social-copy-btn:hover { color: var(--accent-primary); border-color: var(--accent-primary); }
        .social-code-hint { font-size: 0.72rem; color: var(--text-tertiary); }

        /* Add friend row */
        .social-add-row {
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: var(--radius-md); padding: var(--space-md);
            margin-bottom: var(--space-lg);
            animation: cardPop 0.4s cubic-bezier(0.22,1,0.36,1) 0.05s both;
        }
        .social-add-inner { display: flex; align-items: center; gap: var(--space-sm); }
        .social-add-inner svg { color: var(--text-tertiary); flex-shrink: 0; }
        .social-add-input {
            flex: 1; background: var(--bg-tertiary); border: 1px solid var(--glass-border);
            border-radius: var(--radius-sm); padding: 8px 12px;
            color: var(--text-primary); font-size: 0.9rem; font-family: inherit;
            outline: none; transition: border-color var(--transition-fast);
        }
        .social-add-input:focus { border-color: var(--accent-primary); }
        .social-add-input::placeholder { color: var(--text-tertiary); }
        .social-add-btn { flex-shrink: 0; }

        /* Tabs */
        .social-tabs {
            display: flex; gap: 4px;
            background: var(--bg-secondary); border-radius: var(--radius-md);
            padding: 4px; margin-bottom: var(--space-lg);
            animation: cardPop 0.4s cubic-bezier(0.22,1,0.36,1) 0.1s both;
        }
        .social-tab {
            flex: 1; background: none; border: none; cursor: pointer;
            padding: 8px 16px; border-radius: calc(var(--radius-md) - 2px);
            color: var(--text-secondary); font-size: 0.875rem; font-weight: 500;
            font-family: inherit; transition: all var(--transition-fast);
        }
        .social-tab:hover { color: var(--text-primary); }
        .social-tab.active {
            background: var(--glass-bg); color: var(--accent-primary);
            font-weight: 700; box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .social-panel { }

        /* Avatars */
        .social-avatar {
            width: 44px; height: 44px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; font-weight: 700; flex-shrink: 0;
            border: 2px solid var(--glass-border);
        }
        .social-avatar-you {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: #050508; border-color: var(--accent-primary);
        }
        .social-avatar-lg {
            width: 52px; height: 52px; font-size: 1.3rem;
        }

        /* Feed */
        .social-feed { display: flex; flex-direction: column; gap: var(--space-sm); }
        .social-feed-item {
            display: flex; align-items: flex-start; gap: var(--space-md);
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: var(--radius-md); padding: var(--space-md);
            animation: slideInLeft 0.35s cubic-bezier(0.22,1,0.36,1) both;
        }
        .social-feed-content { flex: 1; }
        .social-feed-top { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; flex-wrap: wrap; }
        .social-feed-name { font-weight: 700; font-size: 0.9rem; color: var(--text-primary); }
        .social-feed-type {
            font-size: 0.7rem; font-weight: 700; padding: 2px 8px;
            border-radius: var(--radius-full); text-transform: uppercase; letter-spacing: 0.05em;
        }
        .social-feed-type.streak { background: rgba(251,191,36,0.15); color: #fbbf24; }
        .social-feed-type.milestone { background: rgba(167,139,250,0.15); color: #a78bfa; }
        .social-feed-type.perfect { background: rgba(52,211,153,0.15); color: #34d399; }
        .social-feed-type.goal { background: rgba(56,189,248,0.15); color: #38bdf8; }
        .social-feed-type.badge { background: rgba(249,115,22,0.15); color: #f97316; }
        .social-feed-text { font-size: 0.875rem; color: var(--text-secondary); line-height: 1.4; }
        .social-feed-time { font-size: 0.72rem; color: var(--text-tertiary); margin-top: 4px; }

        /* Friends grid */
        .social-friends-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: var(--space-md);
        }
        .social-friend-card {
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg); padding: var(--space-lg);
            animation: cardPop 0.4s cubic-bezier(0.22,1,0.36,1) both;
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
            position: relative;
        }
        .social-friend-card:hover { transform: translateY(-2px); box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
        .social-friend-header { display: flex; align-items: center; gap: var(--space-md); margin-bottom: var(--space-md); }
        .social-friend-avatar-wrap { position: relative; }
        .social-online-dot {
            position: absolute; bottom: 1px; right: 1px;
            width: 11px; height: 11px; border-radius: 50%;
            background: #10b981; border: 2px solid var(--bg-secondary);
        }
        .social-online-dot.offline { background: var(--text-tertiary); }
        .social-friend-name { font-weight: 700; font-size: 0.95rem; color: var(--text-primary); }
        .social-friend-badges { display: flex; gap: 4px; flex-wrap: wrap; margin-top: 3px; }
        .social-badge {
            font-size: 0.65rem; font-weight: 700; padding: 2px 7px;
            border-radius: var(--radius-full); text-transform: uppercase; letter-spacing: 0.04em;
        }
        .social-friend-metrics { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: var(--space-md); }
        .social-metric { text-align: center; }
        .social-metric-val { font-size: 1.15rem; font-weight: 800; color: var(--text-primary); }
        .social-metric-lbl { font-size: 0.68rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.04em; }
        .social-friend-bar-wrap { margin-bottom: 4px; }
        .social-friend-bar-label { display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 4px; }
        .social-friend-bar-track { height: 6px; background: var(--bg-tertiary); border-radius: 3px; overflow: hidden; }
        .social-friend-bar-fill { height: 100%; border-radius: 3px; transition: width 0.6s cubic-bezier(0.22,1,0.36,1); }

        /* Pending friends */
        .social-pending-section { margin-top: var(--space-md); }
        .social-pending-title { font-size: 0.8rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: var(--space-sm); font-weight: 600; }
        .social-pending-list { display: flex; flex-direction: column; gap: 8px; }
        .social-pending-item {
            display: flex; align-items: center; gap: var(--space-md);
            background: var(--bg-secondary); border: 1px dashed var(--glass-border);
            border-radius: var(--radius-md); padding: 10px var(--space-md);
        }
        .social-pending-code { font-family: monospace; font-size: 0.9rem; color: var(--text-secondary); font-weight: 600; flex: 1; }
        .social-pending-label { font-size: 0.7rem; color: var(--warning); text-transform: uppercase; letter-spacing: 0.05em; }
        .social-pending-remove { background: none; border: none; cursor: pointer; color: var(--text-tertiary); font-size: 1rem; padding: 0 4px; }
        .social-pending-remove:hover { color: var(--danger); }

        /* Leaderboard */
        .social-leaderboard-wrap { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg); }
        @media (max-width: 760px) { .social-leaderboard-wrap { grid-template-columns: 1fr; } }
        .social-lb-card {
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg); padding: var(--space-lg);
            animation: cardPop 0.4s cubic-bezier(0.22,1,0.36,1) both;
        }
        .social-lb-title { font-size: 0.8rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-secondary); margin-bottom: var(--space-md); }
        .social-lb-row {
            display: flex; align-items: center; gap: var(--space-sm);
            padding: 10px 8px; border-radius: var(--radius-sm);
            margin-bottom: 4px; transition: background var(--transition-fast);
            animation: slideInLeft 0.3s cubic-bezier(0.22,1,0.36,1) both;
        }
        .social-lb-row.is-you { background: rgba(var(--accent-primary-rgb, 0,212,255), 0.08); border: 1px solid var(--glass-border); border-radius: var(--radius-md); }
        .social-lb-rank { font-size: 0.85rem; font-weight: 800; min-width: 28px; color: var(--text-secondary); }
        .social-lb-rank.gold   { color: #fbbf24; }
        .social-lb-rank.silver { color: #94a3b8; }
        .social-lb-rank.bronze { color: #c4703a; }
        .social-lb-avatar { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.85rem; font-weight: 700; flex-shrink: 0; }
        .social-lb-name { flex: 1; font-size: 0.875rem; font-weight: 600; color: var(--text-primary); }
        .social-lb-you-tag { font-size: 0.65rem; font-weight: 700; color: var(--accent-primary); text-transform: uppercase; letter-spacing: 0.05em; margin-left: 4px; }
        .social-lb-val { font-size: 0.875rem; font-weight: 800; color: var(--accent-primary); }
        .social-lb-unit { font-size: 0.7rem; color: var(--text-tertiary); }

        /* Animations */
        @keyframes cardPop {
            from { opacity: 0; transform: scale(0.97) translateY(8px); }
            to   { opacity: 1; transform: scale(1) translateY(0); }
        }
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-12px); }
            to   { opacity: 1; transform: translateX(0); }
        }

        /* Light mode social adjustments */
        [data-brightness="light"] .social-profile-card,
        [data-brightness="light"] .social-add-row,
        [data-brightness="light"] .social-feed-item,
        [data-brightness="light"] .social-friend-card,
        [data-brightness="light"] .social-lb-card { background: var(--glass-bg); }

        /* ============================================
           LOADING SCREEN — v1.3.8 CINEMATIC OVERHAUL
           4 phases over ~3.6s
           Phase 1 (0–0.9s):   Star field materialises
           Phase 2 (0.6–1.5s): ASCEND wordmark letter-by-letter
           Phase 3 (1.4–3.0s): Rocket on pad → countdown → launch
           Phase 4 (3.0–3.6s): Exhaust lingers, bar completes, fade out
           ============================================ */
        #loading-screen {
            position: fixed; inset: 0; z-index: 99999;
            background: #050508;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            gap: 0;
            transition: opacity 0.55s ease, visibility 0.55s ease;
            overflow: hidden;
        }
        #loading-screen.hidden {
            opacity: 0; visibility: hidden; pointer-events: none;
        }

        /* ---- STAR FIELD ---- */
        .loader-stars {
            position: absolute; inset: 0; pointer-events: none;
        }
        .loader-star {
            position: absolute; border-radius: 50%;
            background: white;
            animation: starAppear 0.6s ease both;
        }
        @keyframes starAppear {
            from { opacity: 0; transform: scale(0); }
            to   { opacity: var(--star-opacity, 0.7); transform: scale(1); }
        }

        /* ---- LAUNCH PAD ---- */
        .loader-scene {
            position: relative;
            width: 200px; height: 220px;
            display: flex; align-items: flex-end; justify-content: center;
            margin-bottom: 32px;
        }
        .loader-pad {
            position: absolute; bottom: 0; left: 50%;
            transform: translateX(-50%);
            width: 90px; height: 12px;
            background: linear-gradient(180deg, #4a4a5a, #2a2a38);
            border-radius: 3px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
            animation: padIn 0.5s cubic-bezier(0.22,1,0.36,1) 1.3s both;
        }
        .loader-pad::before {
            content: ''; position: absolute; bottom: 12px; left: 50%;
            transform: translateX(-50%);
            width: 4px; height: 24px;
            background: #3a3a4a; border-radius: 2px;
        }
        @keyframes padIn {
            from { opacity: 0; transform: translateX(-50%) scaleX(0.4); }
            to   { opacity: 1; transform: translateX(-50%) scaleX(1); }
        }

        /* ---- ROCKET ---- */
        .loader-rocket-wrap {
            position: absolute;
            bottom: 22px;
            display: flex; flex-direction: column; align-items: center;
            animation:
                rocketSit   0.6s cubic-bezier(0.22,1,0.36,1) 1.3s both,
                rocketShake 0.12s ease-in-out 2.15s 3,
                rocketLaunch 0.9s cubic-bezier(0.4, 0, 0.2, 1) 2.58s both;
        }
        @keyframes rocketSit {
            from { opacity: 0; transform: translateY(30px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        @keyframes rocketShake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25%       { transform: translateX(-2px) rotate(-1deg); }
            75%       { transform: translateX(2px) rotate(1deg); }
        }
        @keyframes rocketLaunch {
            0%   { transform: translateY(0);    opacity: 1; }
            30%  { transform: translateY(-20px); opacity: 1; }
            100% { transform: translateY(-280px); opacity: 0; }
        }

        /* Thruster glow while sitting on pad */
        .loader-pad-glow {
            position: absolute; bottom: 8px; left: 50%;
            transform: translateX(-50%);
            width: 40px; height: 40px; border-radius: 50%;
            background: radial-gradient(circle, var(--accent-primary, #00d4ff) 0%, transparent 70%);
            opacity: 0;
            animation: padGlow 0.3s ease-in-out 2.15s 10 alternate;
        }
        @keyframes padGlow {
            from { opacity: 0; transform: translateX(-50%) scale(0.8); }
            to   { opacity: 0.55; transform: translateX(-50%) scale(1.3); }
        }

        /* Thruster flame */
        .loader-flame {
            animation: thrusterFlame 0.18s ease-in-out 2.15s infinite;
            transform-origin: top center;
        }
        @keyframes thrusterFlame {
            0%, 100% { transform: scaleY(1) scaleX(1); opacity: 0.9; }
            50%       { transform: scaleY(1.5) scaleX(0.75); opacity: 0.65; }
        }

        /* Exhaust trail while launching */
        .loader-exhaust {
            position: absolute; bottom: 14px; left: 50%;
            transform: translateX(-50%);
            width: 18px; height: 0;
            border-radius: 0 0 50% 50%;
            background: linear-gradient(180deg, var(--accent-primary, #00d4ff) 0%, transparent 100%);
            opacity: 0;
            animation: exhaustGrow 0.9s ease-out 2.58s both;
        }
        @keyframes exhaustGrow {
            0%   { height: 0; opacity: 0.8; }
            40%  { height: 80px; opacity: 0.6; }
            100% { height: 140px; opacity: 0; }
        }

        /* ---- COUNTDOWN ---- */
        .loader-countdown-wrap {
            position: relative;
            height: 64px;
            width: 200px;
            margin-bottom: 8px;
        }
        .loader-countdown {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3.5rem; font-weight: 900;
            color: var(--accent-primary, #00d4ff);
            letter-spacing: -0.02em;
            opacity: 0;
            text-shadow: 0 0 30px var(--accent-primary, #00d4ff);
        }
        .loader-countdown.cd-3 { animation: cdTick 0.38s ease-out 1.58s both; }
        .loader-countdown.cd-2 { animation: cdTick 0.38s ease-out 1.96s both; }
        .loader-countdown.cd-1 { animation: cdTick 0.38s ease-out 2.34s both; }
        .loader-countdown.cd-go {
            font-size: 2.2rem; letter-spacing: 0.08em;
            animation: cdGo 0.5s cubic-bezier(0.22,1,0.36,1) 2.55s both;
        }
        @keyframes cdTick {
            0%   { opacity: 0; transform: translate(-50%,-50%) scale(1.6); }
            25%  { opacity: 1; transform: translate(-50%,-50%) scale(1); }
            70%  { opacity: 1; transform: translate(-50%,-50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%,-50%) scale(0.7); }
        }
        @keyframes cdGo {
            0%   { opacity: 0; transform: translate(-50%,-50%) scale(2); }
            40%  { opacity: 1; transform: translate(-50%,-50%) scale(1); }
            80%  { opacity: 1; }
            100% { opacity: 0; transform: translate(-50%,-50%) scale(0.5); }
        }

        /* ---- WORDMARK ---- */
        .loader-wordmark-wrap {
            display: flex; gap: 0.04em;
            animation: none;
            margin-bottom: 10px;
        }
        .loader-letter {
            font-size: 2.6rem; font-weight: 900;
            letter-spacing: 0.04em;
            background: linear-gradient(135deg, var(--accent-primary, #00d4ff), var(--accent-secondary, #0095ff));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            opacity: 0;
            display: inline-block;
            animation: letterDrop 0.45s cubic-bezier(0.22,1,0.36,1) both;
        }
        .loader-letter:nth-child(1) { animation-delay: 0.6s; }
        .loader-letter:nth-child(2) { animation-delay: 0.72s; }
        .loader-letter:nth-child(3) { animation-delay: 0.84s; }
        .loader-letter:nth-child(4) { animation-delay: 0.96s; }
        .loader-letter:nth-child(5) { animation-delay: 1.08s; }
        .loader-letter:nth-child(6) { animation-delay: 1.20s; }
        @keyframes letterDrop {
            from { opacity: 0; transform: translateY(-18px) scale(1.2); filter: blur(4px); }
            to   { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
        }

        /* ---- TAGLINE ---- */
        .loader-tagline {
            font-size: 0.72rem; color: rgba(255,255,255,0.4);
            letter-spacing: 0.22em; text-transform: uppercase;
            margin-bottom: 36px;
            opacity: 0;
            animation: taglineIn 0.7s ease 1.35s both;
        }
        @keyframes taglineIn {
            from { opacity: 0; transform: translateY(6px); letter-spacing: 0.38em; }
            to   { opacity: 1; transform: translateY(0); letter-spacing: 0.22em; }
        }

        /* ---- PROGRESS BAR ---- */
        .loader-bar-track {
            width: 180px; height: 2px;
            background: rgba(255,255,255,0.08); border-radius: 2px; overflow: hidden;
            margin-top: 0;
        }
        .loader-bar-fill {
            height: 100%; border-radius: 2px;
            background: linear-gradient(90deg, var(--accent-primary, #00d4ff), var(--accent-secondary, #0095ff));
            animation: loaderBar 3.2s cubic-bezier(0.25, 0.1, 0.25, 1) 0.2s both;
        }
        @keyframes loaderBar {
            0%   { width: 0%; }
            20%  { width: 15%; }
            50%  { width: 45%; }
            75%  { width: 72%; }
            90%  { width: 88%; }
            100% { width: 100%; }
        }

        /* ---- STATUS LINE ---- */
        .loader-status {
            font-size: 0.65rem; color: rgba(255,255,255,0.25);
            letter-spacing: 0.14em; text-transform: uppercase;
            margin-top: 12px; height: 1em;
            animation: statusIn 0.4s ease 0.8s both;
        }
        @keyframes statusIn {
            from { opacity: 0; } to { opacity: 1; }
        }
        /* cycle through status messages via JS */
    </style>
</head>
<body>
    <!-- LOADING SCREEN v1.3.8 — CINEMATIC -->
    <div id="loading-screen">
        <!-- Star field (generated by JS) -->
        <div class="loader-stars" id="loader-stars"></div>

        <!-- Wordmark — letter by letter -->
        <div class="loader-wordmark-wrap">
            <span class="loader-letter">A</span>
            <span class="loader-letter">S</span>
            <span class="loader-letter">C</span>
            <span class="loader-letter">E</span>
            <span class="loader-letter">N</span>
            <span class="loader-letter">D</span>
        </div>
        <div class="loader-tagline">Your Growth Dashboard</div>

        <!-- Countdown (above the rocket scene, no overlap) -->
        <div class="loader-countdown-wrap">
            <div class="loader-countdown cd-3">3</div>
            <div class="loader-countdown cd-2">2</div>
            <div class="loader-countdown cd-1">1</div>
            <div class="loader-countdown cd-go">GO</div>
        </div>

        <!-- Rocket scene -->
        <div class="loader-scene">
            <!-- Exhaust column (appears during launch) -->
            <div class="loader-exhaust"></div>

            <!-- Pad glow -->
            <div class="loader-pad-glow"></div>

            <!-- Rocket -->
            <div class="loader-rocket-wrap">
                <svg width="54" height="90" viewBox="0 0 54 90" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- Thruster flame (sits below rocket body) -->
                    <g class="loader-flame" transform="translate(16, 68)">
                        <path d="M11 0 C7 9 3 16 6 23 C8 27 14 27 16 23 C19 16 15 9 11 0Z"
                              fill="url(#flameGrad2)"/>
                    </g>
                    <!-- Rocket body -->
                    <path d="M27 2 C27 2 13 18 13 48 L41 48 C41 18 27 2 27 2Z"
                          fill="var(--accent-primary, #00d4ff)"/>
                    <!-- Nose highlight -->
                    <path d="M27 2 C27 2 20 16 20 48 L27 48 C27 18 27 2 27 2Z"
                          fill="var(--accent-secondary, #0095ff)" opacity="0.6"/>
                    <!-- Porthole -->
                    <circle cx="27" cy="32" r="7" fill="#050508" opacity="0.85"/>
                    <circle cx="27" cy="32" r="5" fill="var(--accent-secondary, #0095ff)" opacity="0.5"/>
                    <circle cx="24.5" cy="29.5" r="1.5" fill="white" opacity="0.6"/>
                    <!-- Fins -->
                    <path d="M13 48 L4 64 L17 56 Z" fill="var(--accent-secondary, #0095ff)"/>
                    <path d="M41 48 L50 64 L37 56 Z" fill="var(--accent-secondary, #0095ff)"/>
                    <!-- Base band -->
                    <rect x="17" y="46" width="20" height="5" rx="1.5" fill="var(--accent-primary, #00d4ff)" opacity="0.8"/>
                    <defs>
                        <linearGradient id="flameGrad2" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="0%" stop-color="#fbbf24"/>
                            <stop offset="55%" stop-color="var(--accent-primary, #00d4ff)" stop-opacity="0.7"/>
                            <stop offset="100%" stop-color="transparent"/>
                        </linearGradient>
                    </defs>
                </svg>
            </div>

            <!-- Launch pad -->
            <div class="loader-pad"></div>
        </div>

        <!-- Progress bar -->
        <div class="loader-bar-track">
            <div class="loader-bar-fill"></div>
        </div>
        <div class="loader-status" id="loader-status">Initialising systems</div>
    </div>


    <div class="bg-gradient bg-gradient-1"></div>
    <div class="bg-gradient bg-gradient-2"></div>
    <canvas id="confetti-canvas"></canvas>
    <div class="toast-container" id="toast-container"></div>
    <div class="mobile-menu-btn" onclick="toggleMobileSidebar()">☰</div>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <!-- Header: logo icon always visible, text + toggle fade out when collapsed -->
            <div class="sidebar-header">
                <div class="sidebar-logo-icon" onclick="toggleSidebar()" title="Toggle sidebar"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/></svg></div>
                <span class="sidebar-logo-text">ASCEND</span>
                <div class="sidebar-toggle" onclick="toggleSidebar()" title="Collapse">◀</div>
            </div>

            <nav class="sidebar-nav">
                <!-- Expand button: only visible when collapsed -->
                <div class="sidebar-expand-btn" onclick="toggleSidebar()" title="Expand sidebar">▶</div>

                <div class="nav-item" onclick="navigateTo('dashboard')" data-page="dashboard" data-tooltip="Dashboard">
                    <span class="nav-item-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/></svg></span>
                    <span class="nav-item-text">Dashboard</span>
                </div>
                <div class="nav-item" onclick="navigateTo('habits')" data-page="habits" data-tooltip="Habits">
                    <span class="nav-item-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg></span>
                    <span class="nav-item-text">Habits</span>
                </div>
                <div class="nav-item" onclick="navigateTo('calendar')" data-page="calendar" data-tooltip="Calendar">
                    <span class="nav-item-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></span>
                    <span class="nav-item-text">Calendar</span>
                </div>
                <div class="nav-item" onclick="navigateTo('journal')" data-page="journal" data-tooltip="Journal">
                    <span class="nav-item-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg></span>
                    <span class="nav-item-text">Journal</span>
                </div>
                <div class="nav-item" onclick="navigateTo('goals')" data-page="goals" data-tooltip="Goals">
                    <span class="nav-item-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg></span>
                    <span class="nav-item-text">Goals</span>
                </div>
                <div class="nav-item" onclick="navigateTo('analytics')" data-page="analytics" data-tooltip="Analytics">
                    <span class="nav-item-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></span>
                    <span class="nav-item-text">Analytics</span>
                </div>
                <div class="nav-item" onclick="navigateTo('social')" data-page="social" data-tooltip="Social">
                    <span class="nav-item-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></span>
                    <span class="nav-item-text">Social</span>
                </div>
                <div class="nav-item" onclick="navigateTo('settings')" data-page="settings" data-tooltip="Settings">
                    <span class="nav-item-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></span>
                    <span class="nav-item-text">Settings</span>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="sidebar-footer-hint" id="sidebar-theme-hint"></div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="main-content">
            <!-- Dashboard Page -->
            <div class="page active" id="page-dashboard">
                <div class="page-header">
                    <h1 class="page-title">Dashboard</h1>
                    <p class="page-subtitle">Your growth at a glance</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Current Streak</div>
                        <div class="stat-value" id="stat-streak">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Habits</div>
                        <div class="stat-value" id="stat-total">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Completed Today</div>
                        <div class="stat-value" id="stat-completed">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Success Rate</div>
                        <div class="stat-value" id="stat-rate">0%</div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 1rem;">Quick Actions</h3>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn" onclick="navigateTo('habits')">
                            <span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg></span><span>Track Habits</span>
                        </button>
                        <button class="btn" onclick="navigateTo('calendar')">
                            <span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></span><span>View Calendar</span>
                        </button>
                        <button class="btn" onclick="navigateTo('goals')">
                            <span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg></span><span>View Goals</span>
                        </button>
                        <button class="btn" onclick="navigateTo('analytics')">
                            <span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></span><span>See Analytics</span>
                        </button>
                    </div>
                </div>

                <!-- Goals widget -->
                <div class="dashboard-goals-widget" id="dashboard-goals-widget">
                    <div class="widget-header">
                        <span class="widget-title">Active Goals</span>
                        <span class="widget-link" onclick="navigateTo('goals')">View all →</span>
                    </div>
                    <div id="dashboard-goals-list">
                        <p style="color:var(--text-tertiary); font-size:0.875rem; text-align:center; padding:var(--space-lg) 0;">
                            No goals yet — <span style="color:var(--accent-primary); cursor:pointer;" onclick="navigateTo('goals')">set your first goal</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Habits Page -->
            <div class="page" id="page-habits">
                <div class="page-header">
                    <h1 class="page-title">Habits</h1>
                    <p class="page-subtitle">Build better habits, one day at a time</p>
                </div>

                <div class="card">
                    <div class="form-group">
                        <input type="text" class="form-input" id="habit-input" placeholder="Add a new habit...">
                        <button class="btn" onclick="addHabit()">Add Habit</button>
                    </div>
                </div>

                <div id="habits-list"></div>
            </div>

            <!-- Calendar Page -->
            <div class="page" id="page-calendar">
                <div class="page-header">
                    <h1 class="page-title">Calendar</h1>
                    <p class="page-subtitle">Track your progress over time</p>
                </div>

                <div class="card">
                    <div class="calendar-controls">
                        <div class="calendar-nav">
                            <button class="btn-secondary btn" id="cal-prev-btn" onclick="calPrev()">◀ Prev</button>
                            <button class="btn-secondary btn" onclick="goToToday()">Today</button>
                            <button class="btn-secondary btn" id="cal-next-btn" onclick="calNext()">Next ▶</button>
                        </div>
                        <h2 id="calendar-month-year"></h2>
                        <div class="cal-view-toggle">
                            <button class="cal-view-btn active" id="view-month" onclick="setCalView('month')">Month</button>
                            <button class="cal-view-btn" id="view-year" onclick="setCalView('year')">Year</button>
                        </div>
                    </div>

                    <!-- Month view -->
                    <div id="cal-month-view">
                        <div class="calendar-grid" id="calendar-grid"></div>
                    </div>

                    <!-- Year view -->
                    <div id="cal-year-view" style="display:none;">
                        <div class="year-view" id="year-grid"></div>
                    </div>
                </div>

                <div class="card" id="day-detail" style="display: none;">
                    <h3 id="day-detail-title"></h3>
                    <div id="day-detail-content"></div>
                </div>
            </div>

            <!-- Journal Page -->
            <div class="page" id="page-journal">
                <div class="page-header">
                    <h1 class="page-title">Journal</h1>
                    <p class="page-subtitle">Write. Reflect. Grow.</p>
                </div>

                <!-- Stats row -->
                <div class="journal-stats-row">
                    <div class="journal-stat-pill">
                        <span class="stat-val" id="journal-stat-entries">0</span>
                        <span class="stat-lbl">Total Entries</span>
                    </div>
                    <div class="journal-stat-pill">
                        <span class="stat-val" id="journal-stat-streak">0</span>
                        <span class="stat-lbl">Writing Streak</span>
                    </div>
                    <div class="journal-stat-pill">
                        <span class="stat-val" id="journal-stat-words">0</span>
                        <span class="stat-lbl">Total Words</span>
                    </div>
                </div>

                <div class="journal-layout">
                    <!-- Left: Entry feed -->
                    <div class="journal-feed">
                        <div class="journal-feed-header">
                            <span class="journal-feed-title">Past Entries</span>
                            <span class="journal-entry-count" id="journal-count-badge">0 entries</span>
                        </div>
                        <div id="journal-feed"></div>
                    </div>

                    <!-- Right: Write panel -->
                    <div class="journal-write-panel">
                        <div class="journal-write-card">
                            <div class="journal-write-header">
                                <div>
                                    <div class="journal-write-date" id="journal-write-date">Today</div>
                                    <div class="journal-write-stats" id="journal-write-habit-stats"></div>
                                </div>
                                <div class="journal-save-status" id="journal-save-status">—</div>
                            </div>
                            <div class="journal-prompt" id="journal-prompt-bar">
                                <span class="journal-prompt-icon">💡</span>
                                <span id="journal-prompt-text"></span>
                            </div>
                            <textarea
                                class="journal-textarea"
                                id="journal-textarea"
                                placeholder="Start writing…"
                                oninput="onJournalInput()"
                            ></textarea>
                            <div class="journal-write-footer">
                                <span class="journal-word-count" id="journal-wc">0 words</span>
                                <button class="btn btn-secondary" style="padding:0.4rem 1rem; font-size:0.8rem;" onclick="clearJournalEntry()">Clear</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Goals Page -->
            <div class="page" id="page-goals">
                <div class="page-header">
                    <h1 class="page-title">Goals</h1>
                    <p class="page-subtitle">Build toward everything that matters</p>
                </div>

                <!-- Stats strip -->
                <div class="goals-stats-strip">
                    <div class="gstat-pill"><span class="gv" id="gstat-active">0</span><span class="gl">Active</span></div>
                    <div class="gstat-pill"><span class="gv" id="gstat-achieved">0</span><span class="gl">Achieved</span></div>
                    <div class="gstat-pill"><span class="gv" id="gstat-milestones">0</span><span class="gl">Milestones Hit</span></div>
                    <div class="gstat-pill"><span class="gv" id="gstat-avg">0%</span><span class="gl">Avg Progress</span></div>
                </div>

                <!-- Top row: filters + add button -->
                <div class="goals-top-row">
                    <div class="goals-filter-tabs">
                        <div class="goals-filter-tab active" onclick="filterGoals('all', this)">All</div>
                        <div class="goals-filter-tab" onclick="filterGoals('active', this)">Active</div>
                        <div class="goals-filter-tab" onclick="filterGoals('achieved', this)">Achieved</div>
                        <div class="goals-filter-tab" onclick="filterGoals('health', this)">Health</div>
                        <div class="goals-filter-tab" onclick="filterGoals('mind', this)">Mind</div>
                        <div class="goals-filter-tab" onclick="filterGoals('finance', this)">Finance</div>
                        <div class="goals-filter-tab" onclick="filterGoals('career', this)">Career</div>
                        <div class="goals-filter-tab" onclick="filterGoals('relationships', this)">Relationships</div>
                        <div class="goals-filter-tab" onclick="filterGoals('creative', this)">Creative</div>
                    </div>
                    <button class="btn btn-primary" onclick="openGoalModal()">+ New Goal</button>
                </div>

                <!-- Goals grid -->
                <div class="goals-grid" id="goals-grid"></div>
            </div>

            <!-- Analytics Page -->
            <div class="page" id="page-analytics">
                <div class="page-header">
                    <h1 class="page-title">Analytics</h1>
                    <p class="page-subtitle">Insights into your progress</p>
                </div>

                <!-- Quick Insights Panel -->
                <div class="insights-grid" id="insights-grid">
                    <div class="insight-card">
                        <div class="insight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="22" height="22"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></div>
                        <div class="insight-label">Best Day of Week</div>
                        <div class="insight-value" id="insight-best-day">—</div>
                        <div class="insight-sub" id="insight-best-day-sub">Complete habits to see</div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="22" height="22"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2z"/></svg></div>
                        <div class="insight-label">Most Consistent</div>
                        <div class="insight-value" id="insight-consistent">—</div>
                        <div class="insight-sub" id="insight-consistent-sub">Add habits to see</div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="22" height="22"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
                        <div class="insight-label">Momentum</div>
                        <div class="insight-value" id="insight-momentum">—</div>
                        <div class="insight-sub" id="insight-momentum-sub">Track for 14 days to see</div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="22" height="22"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></div>
                        <div class="insight-label">Journal Streak</div>
                        <div class="insight-value" id="insight-journal-streak">0</div>
                        <div class="insight-sub" id="insight-journal-streak-sub">consecutive days</div>
                    </div>
                </div>

                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>Completion Trend</h3>
                        <select class="form-select" style="width: auto;" id="analytics-range" onchange="updateAnalytics()">
                            <option value="7">Last 7 Days</option>
                            <option value="30" selected>Last 30 Days</option>
                            <option value="90">Last 90 Days</option>
                        </select>
                    </div>
                    <div class="chart-container" id="trend-chart-wrap">
                        <canvas id="trend-chart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 1rem;">Day of Week Performance</h3>
                    <p style="font-size:0.875rem; color:var(--text-secondary); margin-bottom:1rem;">Average completion % by day — last 90 days</p>
                    <div class="dow-chart-container">
                        <canvas id="dow-chart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 1rem;">Habit Performance</h3>
                    <div class="chart-container">
                        <canvas id="performance-chart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 1rem;">Streak Leaderboard</h3>
                    <table class="table" id="streak-table">
                        <thead>
                            <tr>
                                <th>Habit</th>
                                <th>Current Streak</th>
                                <th>Success Rate</th>
                                <th>Badge</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Social Page -->
            <div class="page" id="page-social">
                <div class="page-header">
                    <h1 class="page-title">Social</h1>
                    <p class="page-subtitle">Track your growth alongside friends</p>
                </div>

                <!-- Your Profile Card -->
                <div class="social-profile-card" id="social-profile-card">
                    <div class="social-profile-left">
                        <div class="social-avatar social-avatar-you" id="social-your-avatar">?</div>
                        <div class="social-profile-info">
                            <div class="social-profile-name" id="social-your-name">You</div>
                            <div class="social-profile-joined" id="social-your-joined">Ascender</div>
                        </div>
                    </div>
                    <div class="social-profile-stats" id="social-your-stats">
                        <div class="social-stat-pill"><span class="social-stat-val" id="social-your-streak">0</span><span class="social-stat-lbl">streak</span></div>
                        <div class="social-stat-pill"><span class="social-stat-val" id="social-your-habits">0</span><span class="social-stat-lbl">habits</span></div>
                        <div class="social-stat-pill"><span class="social-stat-val" id="social-your-rate">0%</span><span class="social-stat-lbl">rate</span></div>
                    </div>
                    <div class="social-code-block">
                        <div class="social-code-label">Your Friend Code</div>
                        <div class="social-code-display">
                            <span class="social-code-value" id="social-your-code">ASC-????</span>
                            <button class="social-copy-btn" onclick="copyFriendCode()" title="Copy code">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                            </button>
                        </div>
                        <div class="social-code-hint">Share this code so friends can add you</div>
                    </div>
                </div>

                <!-- Add Friend Row -->
                <div class="social-add-row">
                    <div class="social-add-inner">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>
                        <input class="social-add-input" id="social-add-input" type="text" placeholder="Enter friend code (e.g. ASC-4827)" maxlength="8" oninput="formatFriendCodeInput(this)">
                        <button class="btn social-add-btn" onclick="addFriendByCode()">Add Friend</button>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="social-tabs">
                    <button class="social-tab active" onclick="setSocialTab('feed', this)">Activity Feed</button>
                    <button class="social-tab" onclick="setSocialTab('friends', this)">Friends</button>
                    <button class="social-tab" onclick="setSocialTab('leaderboard', this)">Leaderboard</button>
                </div>

                <!-- Tab Panels -->
                <div id="social-panel-feed" class="social-panel"></div>
                <div id="social-panel-friends" class="social-panel" style="display:none"></div>
                <div id="social-panel-leaderboard" class="social-panel" style="display:none"></div>
            </div>

            <!-- Settings Page -->
            <div class="page" id="page-settings">
                <div class="page-header">
                    <h1 class="page-title">Settings</h1>
                    <p class="page-subtitle">Manage your preferences</p>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">Appearance</h3>

                    <!-- Light / Dark toggle -->
                    <div class="brightness-toggle-row">
                        <div class="brightness-toggle-info">
                            <span class="brightness-toggle-label" id="brightness-label">Dark Mode</span>
                            <span class="brightness-toggle-sub">Switch between dark and light interface</span>
                        </div>
                        <div class="brightness-switch" id="brightness-switch" onclick="toggleBrightness()">
                            <div class="brightness-switch-icons">
                                <span>🌙</span><span>☀️</span>
                            </div>
                            <div class="brightness-switch-knob" id="brightness-knob">🌙</div>
                        </div>
                    </div>

                    <p style="color:var(--text-secondary); font-size:0.875rem; margin-bottom:var(--space-lg);">Choose a theme that matches your energy.</p>
                    <div class="settings-theme-grid" id="settings-theme-grid">
                        <div class="settings-theme-card st-ocean" onclick="setTheme('ocean')"><div class="settings-theme-swatch"></div><div class="settings-theme-label"><span class="settings-theme-name">Ocean</span><span class="settings-theme-check">✓ Active</span></div></div>
                        <div class="settings-theme-card st-sakura" onclick="setTheme('sakura')"><div class="settings-theme-swatch"></div><div class="settings-theme-label"><span class="settings-theme-name">Sakura</span><span class="settings-theme-check">✓ Active</span></div></div>
                        <div class="settings-theme-card st-cyber" onclick="setTheme('cyber')"><div class="settings-theme-swatch"></div><div class="settings-theme-label"><span class="settings-theme-name">Cyber</span><span class="settings-theme-check">✓ Active</span></div></div>
                        <div class="settings-theme-card st-coral" onclick="setTheme('coral')"><div class="settings-theme-swatch"></div><div class="settings-theme-label"><span class="settings-theme-name">Coral</span><span class="settings-theme-check">✓ Active</span></div></div>
                        <div class="settings-theme-card st-emerald" onclick="setTheme('emerald')"><div class="settings-theme-swatch"></div><div class="settings-theme-label"><span class="settings-theme-name">Emerald</span><span class="settings-theme-check">✓ Active</span></div></div>
                        <div class="settings-theme-card st-lavender" onclick="setTheme('lavender')"><div class="settings-theme-swatch"></div><div class="settings-theme-label"><span class="settings-theme-name">Lavender</span><span class="settings-theme-check">✓ Active</span></div></div>
                        <div class="settings-theme-card st-crimson" onclick="setTheme('crimson')"><div class="settings-theme-swatch"></div><div class="settings-theme-label"><span class="settings-theme-name">Crimson</span><span class="settings-theme-check">✓ Active</span></div></div>
                        <div class="settings-theme-card st-gold" onclick="setTheme('gold')"><div class="settings-theme-swatch"></div><div class="settings-theme-label"><span class="settings-theme-name">Gold</span><span class="settings-theme-check">✓ Active</span></div></div>
                        <div class="settings-theme-card st-arctic" onclick="setTheme('arctic')"><div class="settings-theme-swatch"></div><div class="settings-theme-label"><span class="settings-theme-name">Arctic</span><span class="settings-theme-check">✓ Active</span></div></div>
                        <div class="settings-theme-card st-midnight" onclick="setTheme('midnight')"><div class="settings-theme-swatch"></div><div class="settings-theme-label"><span class="settings-theme-name">Midnight</span><span class="settings-theme-check">✓ Active</span></div></div>
                        <div class="settings-theme-card st-nature"   onclick="setTheme('nature')"><div class="settings-theme-swatch"></div><div class="settings-theme-label"><span class="settings-theme-name">Nature</span><span class="settings-theme-check">✓ Active</span></div></div>
                        <div class="settings-theme-card st-mono"     onclick="setTheme('mono')"><div class="settings-theme-swatch"></div><div class="settings-theme-label"><span class="settings-theme-name">Mono</span><span class="settings-theme-check">✓ Active</span></div></div>
                        <div class="settings-theme-card st-earth"    onclick="setTheme('earth')"><div class="settings-theme-swatch"></div><div class="settings-theme-label"><span class="settings-theme-name">Earth</span><span class="settings-theme-check">✓ Active</span></div></div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">Social Profile</h3>
                    <p style="color:var(--text-secondary); font-size:0.875rem; margin-bottom:var(--space-md);">Customize how you appear on the Social Hub leaderboard and friend list.</p>
                    <div class="card" style="display:flex;flex-direction:column;gap:var(--space-md);">
                        <div>
                            <label style="font-size:0.8rem;color:var(--text-secondary);display:block;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.06em;">Display Name</label>
                            <div style="display:flex;gap:var(--space-sm);">
                                <input class="form-input" id="settings-display-name" type="text" placeholder="Your name (shown to friends)" maxlength="24" style="flex:1">
                                <button class="btn" onclick="saveDisplayName()">Save</button>
                            </div>
                        </div>
                        <div>
                            <label style="font-size:0.8rem;color:var(--text-secondary);display:block;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.06em;">Your Friend Code</label>
                            <div style="display:flex;align-items:center;gap:var(--space-sm);">
                                <span id="settings-friend-code" style="font-family:monospace;font-size:1.1rem;font-weight:700;color:var(--accent-primary);letter-spacing:0.1em;">ASC-????</span>
                                <button class="btn" onclick="copyFriendCode()">Copy</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">Habit Templates</h3>
                    <p style="color:var(--text-secondary); font-size:0.875rem; margin-bottom:1rem;">Quick-start with pre-built habit sets. Click any card to add all 3 habits instantly.</p>
                    <div class="templates-grid">
                        <div class="template-card" onclick="applyTemplate('morning')">
                            <div class="template-label">AM</div>
                            <div class="template-name">Morning Routine</div>
                            <div class="template-habits">Meditate · Exercise · Journal</div>
                        </div>
                        <div class="template-card" onclick="applyTemplate('fitness')">
                            <div class="template-label">FIT</div>
                            <div class="template-name">Fitness</div>
                            <div class="template-habits">Workout · Drink 8 glasses of water · Eat protein</div>
                        </div>
                        <div class="template-card" onclick="applyTemplate('study')">
                            <div class="template-label">MND</div>
                            <div class="template-name">Study</div>
                            <div class="template-habits">Read 30 minutes · Practice skills · Review notes</div>
                        </div>
                        <div class="template-card" onclick="applyTemplate('evening')">
                            <div class="template-label">ZZZ</div>
                            <div class="template-name">Evening Routine</div>
                            <div class="template-habits">Unplug from devices · Stretch · Sleep before 11pm</div>
                        </div>
                        <div class="template-card" onclick="applyTemplate('productivity')">
                            <div class="template-label">GTD</div>
                            <div class="template-name">Productivity</div>
                            <div class="template-habits">2 hours deep work · No social media · Plan tomorrow</div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">Data Management</h3>
                    <div class="card">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <button class="btn" onclick="exportCSV()">
                                <span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg></span><span>Export CSV</span>
                            </button>
                            <button class="btn" onclick="exportJSON()">
                                <span>💾</span><span>Export JSON</span>
                            </button>
                            <button class="btn-secondary btn" onclick="document.getElementById('import-file').click()">
                                <span>📥</span><span>Import Data</span>
                            </button>
                            <input type="file" id="import-file" accept=".json,.csv" style="display: none;" onchange="importData(event)">
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">Danger Zone</h3>
                    <div class="danger-zone">
                        <div class="settings-item">
                            <div>
                                <div class="settings-label">Reset Daily Progress</div>
                                <div class="settings-description">Clear today's completions (keeps streaks)</div>
                            </div>
                            <button class="btn-secondary btn" onclick="resetDaily()">Reset</button>
                        </div>
                        <div class="settings-item" style="border-bottom: none;">
                            <div>
                                <div class="settings-label">Clear All Data</div>
                                <div class="settings-description" style="display:flex;align-items:center;gap:6px;"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg> Permanently delete everything</div>
                            </div>
                            <button class="btn-danger btn" onclick="clearAllData()">Clear All</button>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">About</h3>
                    <div class="card">
                        <div class="about-stats-grid">
                            <div class="about-stat-card">
                                <span class="about-stat-value" id="about-days">0</span>
                                <span class="about-stat-label">Total Days Tracked</span>
                            </div>
                            <div class="about-stat-card">
                                <span class="about-stat-value" id="about-completions">0</span>
                                <span class="about-stat-label">Total Completions</span>
                            </div>
                            <div class="about-stat-card">
                                <span class="about-stat-value" id="about-longest">0</span>
                                <span class="about-stat-label">Longest Streak Ever</span>
                            </div>
                            <div class="about-stat-card">
                                <span class="about-stat-value" id="about-storage">0 KB</span>
                                <span class="about-stat-label">Storage Used</span>
                            </div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-label">Version</div>
                            <div>v1.3.9</div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-label">Last Sync</div>
                            <div id="last-sync">Just now</div>
                        </div>
                        <div class="settings-item" style="border-bottom: none;">
                            <div class="settings-label">Storage Used</div>
                            <div id="storage-used">0 KB</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Day Detail Modal -->
    <!-- Add/Edit Goal Modal -->
    <div class="modal" id="goal-modal">
        <div class="modal-content" style="max-width:560px; width:95%;">
            <div class="modal-header">
                <h2 class="modal-title" id="goal-modal-title">New Goal</h2>
            </div>
            <div class="modal-body" style="max-height:70vh; overflow-y:auto;">

                <div class="goal-form-section">
                    <label class="goal-form-label">Goal Title</label>
                    <input class="form-input" id="gf-title" type="text" placeholder="e.g. Run a 5K, Read 12 books, Save $500..." maxlength="80">
                </div>

                <div class="goal-form-section">
                    <label class="goal-form-label">Life Area</label>
                    <div class="area-picker" id="gf-area-picker">
                        <div class="area-option area-health" data-area="health" onclick="selectArea('health')">
                            <span class="area-option-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></span>Health
                        </div>
                        <div class="area-option area-mind" data-area="mind" onclick="selectArea('mind')">
                            <span class="area-option-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96-.46 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96-.46 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg></span>Mind
                        </div>
                        <div class="area-option area-finance" data-area="finance" onclick="selectArea('finance')">
                            <span class="area-option-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></span>Finance
                        </div>
                        <div class="area-option area-career" data-area="career" onclick="selectArea('career')">
                            <span class="area-option-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/><line x1="12" y1="12" x2="12" y2="16"/><line x1="10" y1="14" x2="14" y2="14"/></svg></span>Career
                        </div>
                        <div class="area-option area-relationships" data-area="relationships" onclick="selectArea('relationships')">
                            <span class="area-option-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></span>Relationships
                        </div>
                        <div class="area-option area-creative" data-area="creative" onclick="selectArea('creative')">
                            <span class="area-option-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><circle cx="13.5" cy="6.5" r=".5" fill="currentColor"/><circle cx="17.5" cy="10.5" r=".5" fill="currentColor"/><circle cx="8.5" cy="7.5" r=".5" fill="currentColor"/><circle cx="6.5" cy="12.5" r=".5" fill="currentColor"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/></svg></span>Creative
                        </div>
                    </div>
                </div>

                <div class="goal-form-section">
                    <label class="goal-form-label">Target Date <span style="opacity:0.5">(optional)</span></label>
                    <input class="form-input" id="gf-date" type="date">
                </div>

                <div class="goal-form-section">
                    <label class="goal-form-label">Milestones <span style="opacity:0.5">(up to 5)</span></label>
                    <div class="milestone-add-row">
                        <input class="form-input" id="gf-milestone-input" type="text" placeholder="Add a milestone checkpoint..." maxlength="60">
                        <button class="btn btn-secondary" onclick="addMilestoneToForm()" style="white-space:nowrap">+ Add</button>
                    </div>
                    <ul class="milestone-input-list" id="gf-milestone-list"></ul>
                </div>

                <div class="goal-form-section" id="gf-habits-section">
                    <label class="goal-form-label">Link Habits <span style="opacity:0.5">(optional — auto-tracks progress)</span></label>
                    <div class="habit-link-grid" id="gf-habit-grid"></div>
                </div>

            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeGoalModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveGoal()">Save Goal</button>
            </div>
        </div>
    </div>

    <div class="modal" id="day-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-day-nav">
                    <button class="nav-arrow" id="modal-prev-day" onclick="navigateDay(-1)" title="Previous day (←)">◀</button>
                    <h3 class="modal-title" id="modal-day-title"></h3>
                    <button class="nav-arrow" id="modal-next-day" onclick="navigateDay(1)" title="Next day (→)">▶</button>
                </div>
            </div>
            <div class="modal-body" id="modal-day-content"></div>
            <div class="modal-footer">
                <button class="btn-secondary btn" onclick="closeDayModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirm-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="confirm-title"></h3>
            </div>
            <div class="modal-body" id="confirm-message"></div>
            <div class="modal-footer">
                <button class="btn-secondary btn" onclick="closeConfirmModal()">Cancel</button>
                <button class="btn-danger btn" id="confirm-btn">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        // APP STATE
        let habits = JSON.parse(localStorage.getItem('ascend-habits-v1.2.1')) || 
                     JSON.parse(localStorage.getItem('ascend-habits-v1.2')) || [];
        let journalEntries = JSON.parse(localStorage.getItem('ascend-journal-v1.3')) || {};
        let currentTheme = localStorage.getItem('ascend-theme') || 'ocean';
        let currentBrightness = localStorage.getItem('ascend-brightness') || 'dark';
        let sidebarCollapsed = localStorage.getItem('ascend-sidebar-collapsed') === 'true';
        let currentCalendarDate = new Date();
        let calView = 'month';
        let currentModalDate = null;
        let currentJournalDate = new Date().toDateString();
        let journalSaveTimer = null;
        let charts = {};

        // INITIALIZATION
        function init() {
            setTheme(currentTheme, true);
            applyBrightness(currentBrightness, true);
            if (sidebarCollapsed) {
                document.getElementById('sidebar').classList.add('collapsed');
                document.getElementById('main-content').classList.add('sidebar-collapsed');
            }
            updateStats();
            renderHabits();
            checkDailyReset();
            renderCalendar();
            renderDashboardGoalsWidget();
            window.addEventListener('hashchange', handleRoute);
            handleRoute();
            document.addEventListener('keydown', handleKeyboard);
            updateStorageInfo();
        }

        // ROUTING
        function navigateTo(page) {
            window.location.hash = page;
        }

        function handleRoute() {
            const page = window.location.hash.slice(1) || 'dashboard';
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) item.classList.add('active');
            });
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            const pageElement = document.getElementById(`page-${page}`);
            if (pageElement) {
                pageElement.classList.add('active');
                if (page === 'calendar') renderCalendar();
                if (page === 'analytics') updateAnalytics();
                if (page === 'settings') { updateAboutStats(); populateSettingsSocialFields(); }
                if (page === 'journal') renderJournalPage();
                if (page === 'goals') renderGoalsPage();
                if (page === 'social') renderSocialPage();
            }
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('mobile-open');
            }
        }

        // SIDEBAR
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('sidebar-collapsed');
            sidebarCollapsed = sidebar.classList.contains('collapsed');
            localStorage.setItem('ascend-sidebar-collapsed', sidebarCollapsed);
        }

        function toggleMobileSidebar() {
            document.getElementById('sidebar').classList.toggle('mobile-open');
        }

        // BRIGHTNESS (LIGHT / DARK)
        function toggleBrightness() {
            const next = currentBrightness === 'dark' ? 'light' : 'dark';
            applyBrightness(next);
        }

        function applyBrightness(brightness, skipToast = false) {
            currentBrightness = brightness;
            localStorage.setItem('ascend-brightness', brightness);
            document.documentElement.setAttribute('data-brightness', brightness);

            const sw = document.getElementById('brightness-switch');
            const knob = document.getElementById('brightness-knob');
            const label = document.getElementById('brightness-label');

            if (brightness === 'light') {
                sw && sw.classList.add('light');
                if (knob) knob.textContent = '☀️';
                if (label) label.textContent = 'Light Mode';
            } else {
                sw && sw.classList.remove('light');
                if (knob) knob.textContent = '🌙';
                if (label) label.textContent = 'Dark Mode';
            }

            if (!skipToast) {
                showToast('success', brightness === 'light' ? 'Light Mode' : 'Dark Mode',
                    brightness === 'light' ? 'Switched to light mode' : 'Switched to dark mode');
            }

            // Re-render charts with new background
            if (window.location.hash === '#analytics') {
                setTimeout(() => updateAnalytics(), 100);
            }
        }

        // THEME SYSTEM
        function setTheme(theme, skipToast = false) {
            document.documentElement.setAttribute('data-theme', theme);
            currentTheme = theme;
            localStorage.setItem('ascend-theme', theme);
            // Update settings theme cards
            document.querySelectorAll('.settings-theme-card').forEach(card => card.classList.remove('active'));
            const activeCard = document.querySelector(`.st-${theme}`);
            if (activeCard) activeCard.classList.add('active');
            // Update sidebar hint
            const hint = document.getElementById('sidebar-theme-hint');
            if (hint) hint.textContent = theme.charAt(0).toUpperCase() + theme.slice(1) + ' theme';
            if (!skipToast) {
                showToast('success', '🎨 Theme Changed', `Switched to ${theme.charAt(0).toUpperCase() + theme.slice(1)}`);
            }
            if (window.location.hash === '#analytics') {
                setTimeout(() => updateAnalytics(), 100);
            }
        }

        // HABITS MANAGEMENT
        function addHabit() {
            const input = document.getElementById('habit-input');
            const name = input.value.trim();
            if (!name) return;

            const habit = {
                id: Date.now(),
                name,
                streak: 0,
                completedToday: false,
                lastCompleted: null,
                createdAt: new Date().toISOString(),
                history: {}
            };

            habits.push(habit);
            saveHabits();
            renderHabits();
            updateStats();
            input.value = '';
            showToast('success', '✨ Habit Added', `"${name}" is ready to track!`);
        }

        function toggleHabit(id) {
            const habit = habits.find(h => h.id === id);
            if (!habit) return;

            const today = new Date().toDateString();
            habit.completedToday = !habit.completedToday;

            if (!habit.history) habit.history = {};

            if (habit.completedToday) {
                habit.lastCompleted = today;
                habit.streak++;
                habit.history[today] = true;

                if ([7, 30, 100].includes(habit.streak)) {
                    triggerConfetti();
                    showToast('success', `${habit.streak}-Day Milestone!`, `Amazing streak on "${habit.name}"!`);
                } else {
                    showToast('success', 'Completed!', `${habit.name} · ${habit.streak} day streak`);
                }
            } else {
                habit.streak = Math.max(0, habit.streak - 1);
                delete habit.history[today];
                showToast('info', 'Unchecked', `${habit.name} marked incomplete`);
            }

            saveHabits();
            renderHabits();
            updateStats();

            // Ripple animation on the item just toggled
            setTimeout(() => {
                const items = document.querySelectorAll('.habit-item');
                items.forEach(el => {
                    if (el.getAttribute('onclick')?.includes(String(id))) {
                        el.classList.add('just-completed');
                        setTimeout(() => el.classList.remove('just-completed'), 600);
                    }
                });
            }, 30);
        }

        function renderHabits() {
            const container = document.getElementById('habits-list');
            if (habits.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📋</div>
                        <h3>No habits yet</h3>
                        <p>Start by adding a habit above, or try a quick-start template.</p>
                        <div class="empty-state-cta">
                            <button class="btn" onclick="navigateTo('settings')">
                                <span>⚡</span><span>Browse Templates</span>
                            </button>
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = habits.map(habit => {
                let streakEmoji = '🔥';
                if (habit.streak >= 100) streakEmoji = '👑';
                else if (habit.streak >= 30) streakEmoji = '💎';
                else if (habit.streak >= 7) streakEmoji = '⭐';

                return `
                    <div class="habit-item ${habit.completedToday ? 'completed' : ''}" onclick="toggleHabit(${habit.id})">
                        <div class="habit-content">
                            <div class="habit-checkbox"></div>
                            <div class="habit-name">${habit.name}</div>
                        </div>
                        <div class="habit-streak">
                            <span>${streakEmoji}</span>
                            <span>${habit.streak} day${habit.streak !== 1 ? 's' : ''}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateStats() {
            const total = habits.length;
            const completed = habits.filter(h => h.completedToday).length;
            const maxStreak = Math.max(...habits.map(h => h.streak), 0);
            const rate = total > 0 ? Math.round((completed / total) * 100) : 0;

            animateCountUp('stat-streak', maxStreak);
            animateCountUp('stat-total', total);
            animateCountUp('stat-completed', completed);
            document.getElementById('stat-rate').textContent = rate + '%';
        }

        function animateCountUp(elId, target, duration = 600) {
            const el = document.getElementById(elId);
            if (!el) return;
            const start = 0;
            const startTime = performance.now();
            function step(now) {
                const elapsed = now - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const eased = 1 - Math.pow(1 - progress, 3); // ease-out cubic
                el.textContent = Math.round(start + (target - start) * eased);
                if (progress < 1) requestAnimationFrame(step);
                else el.textContent = target;
            }
            requestAnimationFrame(step);
        }

        function saveHabits() {
            localStorage.setItem('ascend-habits-v1.2.1', JSON.stringify(habits));
            updateStorageInfo();
        }

        function checkDailyReset() {
            const today = new Date().toDateString();
            const lastReset = localStorage.getItem('ascend-last-reset');

            if (lastReset !== today) {
                habits.forEach(habit => {
                    if (habit.lastCompleted !== today) {
                        habit.completedToday = false;
                    }
                });
                localStorage.setItem('ascend-last-reset', today);
                saveHabits();
            }
        }

        // CALENDAR
        function setCalView(view) {
            calView = view;
            document.getElementById('cal-month-view').style.display = view === 'month' ? '' : 'none';
            document.getElementById('cal-year-view').style.display = view === 'year' ? '' : 'none';
            document.getElementById('view-month').classList.toggle('active', view === 'month');
            document.getElementById('view-year').classList.toggle('active', view === 'year');
            document.getElementById('cal-prev-btn').style.display = view === 'year' ? 'none' : '';
            document.getElementById('cal-next-btn').style.display = view === 'year' ? 'none' : '';
            renderCalendar();
        }

        function calPrev() { previousMonth(); }
        function calNext() { nextMonth(); }

        function renderCalendar() {
            if (calView === 'year') {
                renderYearView();
            } else {
                renderMonthView();
            }
        }

        function renderMonthView() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            document.getElementById('calendar-month-year').textContent = 
                new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date().toDateString();

            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
                .map(day => `<div class="calendar-day-header">${day}</div>`)
                .join('');

            for (let i = 0; i < firstDay; i++) {
                grid.innerHTML += '<div class="calendar-day empty"></div>';
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = date.toDateString();
                const isToday = dateStr === today;
                
                let completedCount = 0;
                habits.forEach(habit => {
                    if (habit.history && habit.history[dateStr]) completedCount++;
                });

                const totalHabits = habits.length;
                let completionLevel = 0;
                if (totalHabits > 0) {
                    const percentage = (completedCount / totalHabits) * 100;
                    if (percentage === 0) completionLevel = 0;
                    else if (percentage <= 25) completionLevel = 1;
                    else if (percentage <= 50) completionLevel = 2;
                    else if (percentage <= 75) completionLevel = 3;
                    else if (percentage < 100) completionLevel = 4;
                    else completionLevel = 5;
                }

                grid.innerHTML += `
                    <div class="calendar-day ${isToday ? 'today' : ''}" 
                         data-completion="${completionLevel}"
                         onclick="showDayDetail('${dateStr}', ${day})">
                        ${isToday ? '<div class="today-badge"></div>' : ''}
                        <div class="calendar-day-number">${day}</div>
                        ${journalEntries[dateStr] ? '<div class="journal-dot"></div>' : ''}
                    </div>
                `;
            }
        }

        function renderYearView() {
            const year = currentCalendarDate.getFullYear();
            document.getElementById('calendar-month-year').textContent = year;
            const grid = document.getElementById('year-grid');
            const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
            const today = new Date();

            grid.innerHTML = monthNames.map((name, m) => {
                const firstDay = new Date(year, m, 1).getDay();
                const daysInMonth = new Date(year, m + 1, 0).getDate();

                // Compute monthly avg
                let totalRate = 0, counted = 0;
                for (let d = 1; d <= daysInMonth; d++) {
                    const ds = new Date(year, m, d).toDateString();
                    let comp = 0, tot = 0;
                    habits.forEach(h => {
                        const created = new Date(h.createdAt);
                        if (new Date(year, m, d) >= created) {
                            tot++;
                            if (h.history && h.history[ds]) comp++;
                        }
                    });
                    if (tot > 0) { totalRate += comp / tot; counted++; }
                }
                const avg = counted > 0 ? Math.round((totalRate / counted) * 100) : 0;

                // Build mini grid cells
                let cells = '';
                for (let e = 0; e < firstDay; e++) cells += `<div class="year-mini-day empty-day"></div>`;
                for (let d = 1; d <= daysInMonth; d++) {
                    const ds = new Date(year, m, d).toDateString();
                    let comp = 0, tot = 0;
                    habits.forEach(h => {
                        const created = new Date(h.createdAt);
                        if (new Date(year, m, d) >= created) {
                            tot++;
                            if (h.history && h.history[ds]) comp++;
                        }
                    });
                    let lvl = 0;
                    if (tot > 0) {
                        const pct = comp / tot;
                        if (pct > 0 && pct <= 0.33) lvl = 1;
                        else if (pct <= 0.66) lvl = 2;
                        else if (pct < 1) lvl = 3;
                        else if (pct === 1) lvl = 4;
                    }
                    cells += `<div class="year-mini-day ${lvl > 0 ? 'has-data-' + lvl : ''}"></div>`;
                }

                return `
                    <div class="year-month-card" onclick="jumpToMonth(${year}, ${m})">
                        <div class="year-month-name">${name} ${year}</div>
                        <div class="year-mini-grid">${cells}</div>
                        <div class="year-month-avg">${avg > 0 ? avg + '% avg' : 'No data'}</div>
                    </div>
                `;
            }).join('');
        }

        function jumpToMonth(year, month) {
            currentCalendarDate = new Date(year, month, 1);
            setCalView('month');
        }

        function showDayDetail(dateStr, day) {
            currentModalDate = new Date(dateStr);
            renderDayModal(currentModalDate);
            document.getElementById('day-modal').classList.add('active');
        }

        function renderDayModal(date) {
            const dateStr = date.toDateString();
            const completedHabits = [];
            const missedHabits = [];

            habits.forEach(habit => {
                const wasCompleted = habit.history && habit.history[dateStr];
                const createdDate = new Date(habit.createdAt).toDateString();
                const habitExisted = new Date(dateStr) >= new Date(createdDate);

                if (habitExisted) {
                    if (wasCompleted) completedHabits.push(habit.name);
                    else missedHabits.push(habit.name);
                }
            });

            const total = completedHabits.length + missedHabits.length;
            const rate = total > 0 ? Math.round((completedHabits.length / total) * 100) : 0;
            const isToday = dateStr === new Date().toDateString();
            const isFuture = date > new Date();

            document.getElementById('modal-day-title').textContent = 
                date.toLocaleDateString('en-US', { weekday: 'short', month: 'long', day: 'numeric', year: 'numeric' });
            
            // Disable next arrow if today or future
            document.getElementById('modal-next-day').style.opacity = isFuture || isToday ? '0.3' : '1';
            document.getElementById('modal-next-day').style.pointerEvents = isFuture || isToday ? 'none' : '';

            const journalEntry = journalEntries[dateStr];

            document.getElementById('modal-day-content').innerHTML = `
                <p style="margin-bottom: 1rem; font-size: 1.125rem; font-weight: 600; color: var(--accent-primary);">
                    ${isFuture ? '— Future date —' : `${completedHabits.length}/${total} habits completed (${rate}%)`}
                </p>
                ${!isFuture && completedHabits.length > 0 ? `
                    <h4 style="color: var(--success); margin-bottom: 0.5rem;">✓ Completed</h4>
                    <ul style="list-style: none; margin-bottom: 1rem;">
                        ${completedHabits.map(h => `<li style="padding: 0.25rem 0; color: var(--success);">✓ ${h}</li>`).join('')}
                    </ul>
                ` : ''}
                ${!isFuture && missedHabits.length > 0 ? `
                    <h4 style="color: var(--text-secondary); margin-bottom: 0.5rem;">✗ Missed</h4>
                    <ul style="list-style: none; opacity: 0.6; margin-bottom: 1rem;">
                        ${missedHabits.map(h => `<li style="padding: 0.25rem 0;">✗ ${h}</li>`).join('')}
                    </ul>
                ` : ''}
                ${!isFuture && total === 0 ? '<p style="color: var(--text-secondary); margin-bottom: 1rem;">No habits were tracked on this day yet.</p>' : ''}
                ${!isFuture ? `
                    <div style="border-top: 1px solid var(--glass-border); padding-top: 1rem; margin-top: 0.5rem;">
                        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem;">
                            <h4 style="color: var(--text-secondary); font-size:0.875rem;">Journal</h4>
                            <button class="btn btn-secondary" style="padding:0.3rem 0.8rem; font-size:0.75rem;" onclick="closeDayModal(); openJournalDate('${dateStr}')">Open in Journal →</button>
                        </div>
                        ${journalEntry ? `<p style="font-size:0.875rem; color:var(--text-primary); line-height:1.6; opacity:0.85;">${journalEntry.text.substring(0, 200)}${journalEntry.text.length > 200 ? '…' : ''}</p>` : `<p style="font-size:0.875rem; color:var(--text-tertiary); font-style:italic;">No journal entry for this day.</p>`}
                    </div>
                ` : ''}
            `;
        }

        function navigateDay(direction) {
            if (!currentModalDate) return;
            const newDate = new Date(currentModalDate);
            newDate.setDate(newDate.getDate() + direction);
            // Don't go past today
            if (newDate > new Date()) return;
            currentModalDate = newDate;
            // Update calendar month if we crossed month boundary
            currentCalendarDate = new Date(newDate.getFullYear(), newDate.getMonth(), 1);
            renderDayModal(currentModalDate);
        }

        function closeDayModal() {
            document.getElementById('day-modal').classList.remove('active');
            currentModalDate = null;
        }

        function previousMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendar();
        }

        function goToToday() {
            currentCalendarDate = new Date();
            setCalView('month');
        }

        // ANALYTICS
        function updateAnalytics() {
            const days = parseInt(document.getElementById('analytics-range').value);
            renderInsights(days);
            renderTrendChart(days);
            renderDowChart();
            renderPerformanceChart();
            renderStreakTable();
        }

        function renderInsights(days) {
            // --- Best Day of Week ---
            const dowTotals = [0,0,0,0,0,0,0];
            const dowCounts = [0,0,0,0,0,0,0];
            const today = new Date();
            const dayNames = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];

            for (let i = 89; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                const dow = date.getDay();

                let comp = 0, tot = 0;
                habits.forEach(h => {
                    const created = new Date(h.createdAt);
                    if (date >= created) {
                        tot++;
                        if (h.history && h.history[dateStr]) comp++;
                    }
                });
                if (tot > 0) {
                    dowTotals[dow] += comp / tot;
                    dowCounts[dow]++;
                }
            }

            let bestDow = -1, bestRate = -1;
            dowCounts.forEach((cnt, i) => {
                if (cnt > 0) {
                    const avg = dowTotals[i] / cnt;
                    if (avg > bestRate) { bestRate = avg; bestDow = i; }
                }
            });

            if (bestDow >= 0) {
                document.getElementById('insight-best-day').textContent = dayNames[bestDow];
                document.getElementById('insight-best-day-sub').textContent = `${Math.round(bestRate * 100)}% avg completion`;
            } else {
                document.getElementById('insight-best-day').textContent = '—';
                document.getElementById('insight-best-day-sub').textContent = 'Complete habits to see';
            }

            // --- Most Consistent Habit ---
            let bestHabit = null, bestHabitRate = -1;
            habits.forEach(h => {
                if (!h.history) return;
                const createdDate = new Date(h.createdAt);
                const today2 = new Date();
                const totalDays = Math.max(1, Math.floor((today2 - createdDate) / 86400000) + 1);
                // Only count days where value is truthy (completed), not all history keys
                const comp = Object.values(h.history).filter(v => v === true || v === 1).length;
                const rate = Math.min(1, comp / totalDays); // cap at 100%
                if (rate > bestHabitRate) { bestHabitRate = rate; bestHabit = h; }
            });

            if (bestHabit) {
                const displayName = bestHabit.name.length > 20 ? bestHabit.name.substring(0, 20) + '…' : bestHabit.name;
                document.getElementById('insight-consistent').textContent = displayName;
                document.getElementById('insight-consistent-sub').textContent = `${Math.round(bestHabitRate * 100)}% success rate`;
            } else {
                document.getElementById('insight-consistent').textContent = '—';
                document.getElementById('insight-consistent-sub').textContent = 'Add habits to see';
            }

            // --- Momentum ---
            function getAvgForPeriod(startDaysAgo, endDaysAgo) {
                let total = 0, count = 0;
                for (let i = startDaysAgo; i >= endDaysAgo; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toDateString();
                    let comp = 0, tot = 0;
                    habits.forEach(h => {
                        const created = new Date(h.createdAt);
                        if (date >= created) {
                            tot++;
                            if (h.history && h.history[dateStr]) comp++;
                        }
                    });
                    if (tot > 0) { total += comp / tot; count++; }
                }
                return count > 0 ? total / count : 0;
            }

            const recent7 = getAvgForPeriod(6, 0);
            const prev7 = getAvgForPeriod(13, 7);
            const momentumEl = document.getElementById('insight-momentum');
            const momentumSub = document.getElementById('insight-momentum-sub');

            if (prev7 === 0 && recent7 === 0) {
                momentumEl.textContent = '—';
                momentumEl.className = 'insight-value';
                momentumSub.textContent = 'Track for 14 days to see';
            } else {
                const diff = recent7 - prev7;
                if (diff > 0.05) {
                    momentumEl.innerHTML = '↑ Improving';
                    momentumEl.className = 'insight-value momentum-up';
                    momentumSub.textContent = `+${Math.round(diff * 100)}% vs last week`;
                } else if (diff < -0.05) {
                    momentumEl.innerHTML = '↓ Declining';
                    momentumEl.className = 'insight-value momentum-down';
                    momentumSub.textContent = `${Math.round(diff * 100)}% vs last week`;
                } else {
                    momentumEl.innerHTML = '→ Stable';
                    momentumEl.className = 'insight-value momentum-stable';
                    momentumSub.textContent = 'Consistent pace';
                }
            }

            // --- Journal Streak ---
            const jStreak = calcJournalStreak();
            const jsEl = document.getElementById('insight-journal-streak');
            const jsSub = document.getElementById('insight-journal-streak-sub');
            if (jsEl) jsEl.textContent = jStreak;
            if (jsSub) jsSub.textContent = jStreak === 1 ? 'consecutive day' : 'consecutive days';
        }

        function renderDowChart() {
            const ctx = document.getElementById('dow-chart');
            if (!ctx) return;

            const dowLabels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const dowTotals = [0,0,0,0,0,0,0];
            const dowCounts = [0,0,0,0,0,0,0];
            const today = new Date();

            for (let i = 89; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                // Map JS day (0=Sun) to Mon-first index
                const jsDow = date.getDay();
                const dowIdx = jsDow === 0 ? 6 : jsDow - 1;

                let comp = 0, tot = 0;
                habits.forEach(h => {
                    const created = new Date(h.createdAt);
                    if (date >= created) {
                        tot++;
                        if (h.history && h.history[dateStr]) comp++;
                    }
                });
                if (tot > 0) {
                    dowTotals[dowIdx] += comp / tot;
                    dowCounts[dowIdx]++;
                }
            }

            const data = dowCounts.map((cnt, i) => cnt > 0 ? Math.round((dowTotals[i] / cnt) * 100) : 0);
            const accentColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-primary').trim();
            const textColor = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary').trim();

            if (charts.dow) charts.dow.destroy();
            charts.dow = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dowLabels,
                    datasets: [{
                        data,
                        backgroundColor: data.map(v => v >= 70 ? accentColor : v >= 40 ? accentColor + 'aa' : accentColor + '44'),
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)', padding: 10,
                            callbacks: { label: ctx => `${ctx.raw}% avg` }
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 100, ticks: { color: textColor, callback: v => v + '%' }, grid: { color: 'rgba(255,255,255,0.08)' } },
                        x: { ticks: { color: textColor }, grid: { display: false } }
                    }
                }
            });
        }

        function renderTrendChart(days) {
            const ctx = document.getElementById('trend-chart');
            if (!ctx) return;

            const labels = [];
            const data = [];
            const today = new Date();

            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();

                labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));

                let completedCount = 0;
                let totalHabits = 0;
                let anyActivity = false;

                habits.forEach(habit => {
                    const habitCreated = new Date(habit.createdAt);
                    // Normalize to start of day for fair comparison
                    habitCreated.setHours(0, 0, 0, 0);
                    const dayDate = new Date(date);
                    dayDate.setHours(0, 0, 0, 0);

                    if (dayDate >= habitCreated) {
                        totalHabits++;
                        anyActivity = true;
                        if (habit.history && habit.history[dateStr]) {
                            completedCount++;
                        }
                    }
                });

                // Push null for days before any habits existed — Chart.js skips null points cleanly
                if (!anyActivity) {
                    data.push(null);
                } else {
                    data.push(Math.round((completedCount / totalHabits) * 100));
                }
            }

            if (charts.trend) charts.trend.destroy();
            
            const accentColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-primary').trim();
            const textColor = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary').trim();

            charts.trend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'Completion Rate (%)',
                        data,
                        borderColor: accentColor,
                        backgroundColor: accentColor + '20',
                        tension: 0.4,
                        fill: true,
                        spanGaps: false,
                        pointRadius: 3,
                        pointHoverRadius: 6,
                        borderWidth: 2.5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            displayColors: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { color: textColor },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: textColor },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        function renderPerformanceChart() {
            const ctx = document.getElementById('performance-chart');
            if (!ctx) return;

            const labels = [];
            const data = [];
            const colors = [];

            habits.forEach(habit => {
                if (!habit.history) habit.history = {};
                
                const totalDays = Math.floor((Date.now() - new Date(habit.createdAt)) / (1000 * 60 * 60 * 24)) + 1;
                const completedDays = Object.keys(habit.history).length;
                const rate = totalDays > 0 ? Math.round((completedDays / totalDays) * 100) : 0;
                
                labels.push(habit.name.length > 20 ? habit.name.substring(0, 20) + '...' : habit.name);
                data.push(rate);
                
                if (rate >= 75) colors.push('#10b981');
                else if (rate >= 50) colors.push('#f59e0b');
                else colors.push('#ef4444');
            });

            if (charts.performance) charts.performance.destroy();
            
            const textColor = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary').trim();

            charts.performance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: 'Success Rate (%)',
                        data,
                        backgroundColor: colors,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            displayColors: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { color: textColor },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: textColor },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        function renderStreakTable() {
            const tbody = document.querySelector('#streak-table tbody');
            if (!tbody) return;

            const sortedHabits = [...habits].sort((a, b) => b.streak - a.streak);

            tbody.innerHTML = sortedHabits.map(habit => {
                let badge = '🔥';
                if (habit.streak >= 100) badge = '👑';
                else if (habit.streak >= 30) badge = '💎';
                else if (habit.streak >= 7) badge = '⭐';

                const totalDays = Math.floor((Date.now() - new Date(habit.createdAt)) / (1000 * 60 * 60 * 24)) + 1;
                const completedDays = habit.history ? Object.keys(habit.history).length : 0;
                const rate = totalDays > 0 ? Math.round((completedDays / totalDays) * 100) : 0;

                return `
                    <tr>
                        <td style="font-weight: 500;">${habit.name}</td>
                        <td>${habit.streak} days</td>
                        <td>${rate}%</td>
                        <td style="font-size: 1.5rem;">${badge}</td>
                    </tr>
                `;
            }).join('');
        }

        // SETTINGS
        function exportCSV() {
            if (habits.length === 0) {
                showToast('info', 'No Data', 'Add some habits first!');
                return;
            }

            const headers = ['Name', 'Streak', 'Completed Today', 'Last Completed', 'Created At'];
            const rows = habits.map(h => [
                h.name, h.streak, h.completedToday ? 'Yes' : 'No',
                h.lastCompleted || 'Never', h.createdAt
            ]);

            const csv = [headers, ...rows]
                .map(row => row.map(cell => `"${cell}"`).join(','))
                .join('\n');

            downloadFile(csv, 'ascend-habits.csv', 'text/csv');
            showToast('success', 'Exported', 'CSV file downloaded');
        }

        function exportJSON() {
            const data = {
                version: '1.2.1',
                exportDate: new Date().toISOString(),
                habits,
                theme: currentTheme
            };

            downloadFile(JSON.stringify(data, null, 2), 'ascend-backup.json', 'application/json');
            showToast('success', '💾 Exported', 'JSON backup downloaded');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const content = e.target.result;
                    
                    if (file.name.endsWith('.json')) {
                        const data = JSON.parse(content);
                        if (data.habits) {
                            showConfirm(
                                'Import Data',
                                `This will replace your current ${habits.length} habits with ${data.habits.length} habits from the backup. Continue?`,
                                () => {
                                    habits = data.habits;
                                    if (data.theme) setTheme(data.theme);
                                    saveHabits();
                                    renderHabits();
                                    updateStats();
                                    showToast('success', '📥 Imported', 'Data restored successfully');
                                }
                            );
                        }
                    } else if (file.name.endsWith('.csv')) {
                        const lines = content.split('\n').slice(1); // Skip header
                        const imported = lines.filter(line => line.trim()).map(line => {
                            const [name, streak, completedToday, lastCompleted, createdAt] = 
                                line.split(',').map(cell => cell.replace(/"/g, '').trim());
                            
                            return {
                                id: Date.now() + Math.random(),
                                name,
                                streak: parseInt(streak) || 0,
                                completedToday: completedToday === 'Yes',
                                lastCompleted: lastCompleted === 'Never' ? null : lastCompleted,
                                createdAt: createdAt || new Date().toISOString(),
                                history: {}
                            };
                        });

                        showConfirm(
                            'Import CSV',
                            `Import ${imported.length} habits? This will merge with your existing habits.`,
                            () => {
                                habits = [...habits, ...imported];
                                saveHabits();
                                renderHabits();
                                updateStats();
                                showToast('success', '📥 Imported', `${imported.length} habits added`);
                            }
                        );
                    }
                } catch (error) {
                    showToast('error', 'Import Failed', 'Invalid file format');
                }
            };
            reader.readAsText(file);
            event.target.value = ''; // Reset input
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function resetDaily() {
            showConfirm(
                'Reset Daily Progress',
                'This will clear today\'s completions but keep all streaks intact. Continue?',
                () => {
                    habits.forEach(habit => habit.completedToday = false);
                    saveHabits();
                    renderHabits();
                    updateStats();
                    showToast('success', '🔄 Reset', 'Daily progress cleared');
                }
            );
        }

        function clearAllData() {
            showConfirm(
                '⚠️ Clear All Data',
                'This will PERMANENTLY delete all your habits and progress. This cannot be undone! Are you absolutely sure?',
                () => {
                    habits = [];
                    saveHabits();
                    localStorage.removeItem('ascend-last-reset');
                    renderHabits();
                    updateStats();
                    showToast('success', 'Cleared', 'All data has been deleted');
                }
            );
        }

        function updateStorageInfo() {
            const dataSize = new Blob([localStorage.getItem('ascend-habits-v1.2.1') || '']).size;
            const sizeStr = `${(dataSize / 1024).toFixed(2)} KB`;
            document.getElementById('storage-used').textContent = sizeStr;
            document.getElementById('last-sync').textContent = new Date().toLocaleString();
        }

        function updateAboutStats() {
            // Total days tracked (distinct days with any completion)
            const allDays = new Set();
            let totalCompletions = 0;
            let longestStreak = 0;

            habits.forEach(h => {
                if (!h.history) return;
                Object.keys(h.history).forEach(d => { allDays.add(d); totalCompletions++; });
                longestStreak = Math.max(longestStreak, h.streak || 0);
            });

            const dataSize = new Blob([localStorage.getItem('ascend-habits-v1.2.1') || '']).size;

            animateAboutStat('about-days', allDays.size);
            animateAboutStat('about-completions', totalCompletions);
            animateAboutStat('about-longest', longestStreak);
            document.getElementById('about-storage').textContent = `${(dataSize / 1024).toFixed(1)} KB`;
            document.getElementById('storage-used').textContent = `${(dataSize / 1024).toFixed(2)} KB`;
            document.getElementById('last-sync').textContent = new Date().toLocaleString();
        }

        function animateAboutStat(elId, target, duration = 800) {
            const el = document.getElementById(elId);
            if (!el) return;
            const startTime = performance.now();
            function step(now) {
                const p = Math.min((now - startTime) / duration, 1);
                const eased = 1 - Math.pow(1 - p, 3);
                el.textContent = Math.round(target * eased);
                if (p < 1) requestAnimationFrame(step);
                else el.textContent = target;
            }
            requestAnimationFrame(step);
        }

        // HABIT TEMPLATES
        const TEMPLATES = {
            morning: ['Meditate', 'Exercise', 'Journal'],
            fitness: ['Workout', 'Drink 8 glasses of water', 'Eat protein'],
            study: ['Read 30 minutes', 'Practice skills', 'Review notes'],
            evening: ['Unplug from devices', 'Stretch', 'Sleep before 11pm'],
            productivity: ['2 hours deep work', 'No social media', 'Plan tomorrow']
        };

        function applyTemplate(key) {
            const templateHabits = TEMPLATES[key];
            if (!templateHabits) return;

            const added = [];
            templateHabits.forEach(name => {
                // Only add if not already present
                if (!habits.find(h => h.name.toLowerCase() === name.toLowerCase())) {
                    habits.push({
                        id: Date.now() + Math.random(),
                        name,
                        streak: 0,
                        completedToday: false,
                        lastCompleted: null,
                        createdAt: new Date().toISOString(),
                        history: {}
                    });
                    added.push(name);
                }
            });

            if (added.length === 0) {
                showToast('info', 'Already Added', 'These habits are already in your list!');
                return;
            }

            saveHabits();
            renderHabits();
            updateStats();
            const templateNames = { morning: 'Morning Routine', fitness: 'Fitness', study: 'Study', evening: 'Evening Routine', productivity: 'Productivity' };
            showToast('success', `✨ ${templateNames[key]}`, `Added ${added.length} habit${added.length !== 1 ? 's' : ''}!`);
            setTimeout(() => navigateTo('habits'), 600);
        }

        // MODALS
        function showConfirm(title, message, onConfirm) {
            document.getElementById('confirm-title').textContent = title;
            document.getElementById('confirm-message').textContent = message;
            document.getElementById('confirm-btn').onclick = () => {
                onConfirm();
                closeConfirmModal();
            };
            document.getElementById('confirm-modal').classList.add('active');
        }

        function closeConfirmModal() {
            document.getElementById('confirm-modal').classList.remove('active');
        }

        // TOAST
        function showToast(type, title, message, duration = 4000) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icons = { success: '✓', error: '✕', info: 'i', warning: '!' };
            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || 'ℹ'}</div>
                <div>
                    <div style="font-weight: 600;">${title}</div>
                    ${message ? `<div style="font-size: 0.875rem; color: var(--text-secondary);">${message}</div>` : ''}
                </div>
            `;
            container.appendChild(toast);
            setTimeout(() => {
                toast.classList.add('hiding');
                setTimeout(() => toast.remove(), 280);
            }, duration);
        }

        // CONFETTI
        function triggerConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            const colors = ['#00d4ff', '#0095ff', '#10b981', '#f59e0b', '#ef4444'];

            for (let i = 0; i < 150; i++) {
                particles.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10 - 5,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 5 + 3
                });
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach((p, i) => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.3;
                    ctx.fillStyle = p.color;
                    ctx.fillRect(p.x, p.y, p.size, p.size);
                    if (p.y > canvas.height) particles.splice(i, 1);
                });
                if (particles.length > 0) requestAnimationFrame(animate);
            }
            animate();
        }

        // ============================================
        // JOURNAL — v1.3
        // ============================================

        const JOURNAL_PROMPTS = [
            "What made today's habits feel easy or hard?",
            "One thing you want to remember about today.",
            "What would tomorrow-you thank you for doing today?",
            "What habit felt like a chore vs. felt genuinely good?",
            "How did your energy levels track with your completions?",
            "What distracted you most today, and how did you handle it?",
            "Name one small win from today — big or tiny.",
            "What would you do differently if you could replay today?",
            "How does today compare to last week at this time?",
            "What are you building toward, and did today move you closer?",
            "Describe your mood in three words.",
            "What's one habit you want to strengthen this week?",
            "What did completing (or missing) habits teach you today?",
            "If today had a title, what would it be?",
            "Who or what supported your progress today?",
            "What's the hardest part of your current routine?",
            "What surprised you about yourself today?",
            "Write freely — whatever's on your mind right now.",
            "What does consistency mean to you this week?",
            "What would a perfect version of tomorrow look like?"
        ];

        function getDailyPrompt(dateStr) {
            // Deterministic prompt based on date so it doesn't change on re-render
            const seed = new Date(dateStr).getTime();
            return JOURNAL_PROMPTS[Math.abs(seed) % JOURNAL_PROMPTS.length];
        }

        function saveJournal() {
            localStorage.setItem('ascend-journal-v1.3', JSON.stringify(journalEntries));
        }

        function calcJournalStreak() {
            let streak = 0;
            const today = new Date();
            for (let i = 0; i < 365; i++) {
                const d = new Date(today);
                d.setDate(d.getDate() - i);
                const ds = d.toDateString();
                if (journalEntries[ds] && journalEntries[ds].text.trim().length > 0) {
                    streak++;
                } else {
                    break;
                }
            }
            return streak;
        }

        function getWordCount(text) {
            return text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
        }

        function openJournalDate(dateStr) {
            currentJournalDate = dateStr;
            navigateTo('journal');
        }

        function renderJournalPage() {
            // Set up write panel for today (or last opened date)
            loadJournalWritePanel(currentJournalDate);
            // Render feed
            renderJournalFeed();
            // Update stats
            updateJournalStats();
        }

        function loadJournalWritePanel(dateStr) {
            currentJournalDate = dateStr;
            const isToday = dateStr === new Date().toDateString();
            const dateDisplay = isToday
                ? 'Today — ' + new Date(dateStr).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })
                : new Date(dateStr).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });

            document.getElementById('journal-write-date').textContent = dateDisplay;

            // Habit stats for this day
            let comp = 0, tot = 0;
            habits.forEach(h => {
                const created = new Date(h.createdAt);
                if (new Date(dateStr) >= created) {
                    tot++;
                    if (h.history && h.history[dateStr]) comp++;
                }
            });
            const statsEl = document.getElementById('journal-write-habit-stats');
            if (statsEl) statsEl.textContent = tot > 0 ? `${comp}/${tot} habits completed` : 'No habits tracked';

            // Prompt
            const prompt = getDailyPrompt(dateStr);
            const promptEl = document.getElementById('journal-prompt-text');
            if (promptEl) promptEl.textContent = prompt;

            // Load existing entry or clear
            const entry = journalEntries[dateStr];
            const ta = document.getElementById('journal-textarea');
            if (ta) {
                ta.value = entry ? entry.text : '';
                updateJournalWordCount();
            }

            const statusEl = document.getElementById('journal-save-status');
            if (statusEl) statusEl.textContent = entry ? '✓ Saved' : '—';
            if (statusEl && entry) statusEl.classList.add('saved');
        }

        function onJournalInput() {
            const ta = document.getElementById('journal-textarea');
            if (!ta) return;
            updateJournalWordCount();

            // Show prompt bar only when empty
            const promptBar = document.getElementById('journal-prompt-bar');
            if (promptBar) promptBar.style.display = ta.value.trim() === '' ? '' : 'none';

            const statusEl = document.getElementById('journal-save-status');
            if (statusEl) { statusEl.textContent = 'Saving…'; statusEl.classList.remove('saved'); }

            // Debounced save
            clearTimeout(journalSaveTimer);
            journalSaveTimer = setTimeout(() => {
                const text = ta.value;
                if (text.trim().length > 0) {
                    journalEntries[currentJournalDate] = {
                        text,
                        savedAt: new Date().toISOString(),
                        promptUsed: getDailyPrompt(currentJournalDate)
                    };
                } else {
                    delete journalEntries[currentJournalDate];
                }
                saveJournal();
                if (statusEl) { statusEl.textContent = '✓ Saved'; statusEl.classList.add('saved'); }
                // Refresh feed and calendar dots
                renderJournalFeed();
                updateJournalStats();
                // Refresh calendar if open so dots update
                if (window.location.hash === '#calendar') renderCalendar();
            }, 800);
        }

        function updateJournalWordCount() {
            const ta = document.getElementById('journal-textarea');
            const wc = document.getElementById('journal-wc');
            if (ta && wc) {
                const count = getWordCount(ta.value);
                wc.textContent = `${count} word${count !== 1 ? 's' : ''}`;
            }
        }

        function clearJournalEntry() {
            const ta = document.getElementById('journal-textarea');
            if (!ta || ta.value.trim() === '') return;
            if (!confirm('Clear this entry? This cannot be undone.')) return;
            ta.value = '';
            delete journalEntries[currentJournalDate];
            saveJournal();
            updateJournalWordCount();
            const statusEl = document.getElementById('journal-save-status');
            if (statusEl) { statusEl.textContent = '—'; statusEl.classList.remove('saved'); }
            renderJournalFeed();
            updateJournalStats();
        }

        function renderJournalFeed() {
            const feed = document.getElementById('journal-feed');
            const countBadge = document.getElementById('journal-count-badge');
            if (!feed) return;

            const entries = Object.entries(journalEntries)
                .filter(([, v]) => v.text && v.text.trim().length > 0)
                .sort((a, b) => new Date(b[0]) - new Date(a[0]));

            if (countBadge) countBadge.textContent = `${entries.length} ${entries.length === 1 ? 'entry' : 'entries'}`;

            if (entries.length === 0) {
                feed.innerHTML = `
                    <div class="journal-empty">
                        <div class="journal-empty-icon">✦</div>
                        <h3 style="margin-bottom:0.5rem;">Your story starts here</h3>
                        <p style="font-size:0.875rem;">Write your first entry using the panel →</p>
                    </div>
                `;
                return;
            }

            feed.innerHTML = entries.map(([dateStr, entry]) => {
                // Habit stats for this day
                let comp = 0, tot = 0;
                habits.forEach(h => {
                    const created = new Date(h.createdAt);
                    if (new Date(dateStr) >= created) {
                        tot++;
                        if (h.history && h.history[dateStr]) comp++;
                    }
                });
                const rate = tot > 0 ? Math.round((comp / tot) * 100) : 0;
                const isPerfect = tot > 0 && comp === tot;
                const wc = getWordCount(entry.text);
                const isActive = dateStr === currentJournalDate;
                const dateLabel = new Date(dateStr).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });

                return `
                    <div class="journal-entry-card ${isActive ? 'active-entry' : ''}" onclick="loadJournalWritePanel('${dateStr}'); highlightFeedEntry('${dateStr}')">
                        <div class="journal-entry-meta">
                            <span class="journal-entry-date">${dateLabel}</span>
                            <span class="journal-entry-badge ${isPerfect ? 'perfect' : ''}">${tot > 0 ? `${comp}/${tot} habits` : 'No habits'}</span>
                        </div>
                        <div class="journal-entry-preview">${entry.text}</div>
                        <div class="journal-entry-footer">
                            <span>${wc} words</span>
                            ${tot > 0 ? `<span>${rate}%</span>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function highlightFeedEntry(dateStr) {
            document.querySelectorAll('.journal-entry-card').forEach(c => c.classList.remove('active-entry'));
            event.currentTarget.classList.add('active-entry');
        }

        function updateJournalStats() {
            const entries = Object.entries(journalEntries).filter(([, v]) => v.text && v.text.trim().length > 0);
            const totalWords = entries.reduce((sum, [, v]) => sum + getWordCount(v.text), 0);
            const streak = calcJournalStreak();

            const elEntries = document.getElementById('journal-stat-entries');
            const elStreak = document.getElementById('journal-stat-streak');
            const elWords = document.getElementById('journal-stat-words');
            if (elEntries) elEntries.textContent = entries.length;
            if (elStreak) elStreak.textContent = streak;
            if (elWords) elWords.textContent = totalWords;
        }

        // ============================================
        // GOALS & MILESTONES — v1.3.4
        // ============================================

        let goals = JSON.parse(localStorage.getItem('ascend-goals-v1.3.4')) || {};
        let goalModalMode = 'add'; // 'add' | 'edit'
        let editingGoalId = null;
        let goalFormMilestones = [];
        let goalFormArea = 'health';
        let goalFormLinkedHabits = [];
        let currentGoalFilter = 'all';

        const AREA_META = {
            health:        { label: 'Health',        icon: 'H',  color: '#10b981' },
            mind:          { label: 'Mind',           icon: 'M',  color: '#8b5cf6' },
            finance:       { label: 'Finance',        icon: 'F',  color: '#f59e0b' },
            career:        { label: 'Career',         icon: 'C',  color: '#3b82f6' },
            relationships: { label: 'Relationships',  icon: 'R',  color: '#ec4899' },
            creative:      { label: 'Creative',       icon: 'Cr', color: '#f97316' },
        };

        function genGoalId() {
            return 'goal_' + Date.now().toString(36) + Math.random().toString(36).slice(2,6);
        }

        function saveGoals() {
            localStorage.setItem('ascend-goals-v1.3.4', JSON.stringify(goals));
        }

        // ---- PROGRESS CALCULATION ----
        function calcGoalProgress(goal) {
            let habitPct = 0, milestonePct = 0;

            // Habit component (70%): avg completion of linked habits over last 30 days
            if (goal.linkedHabits && goal.linkedHabits.length > 0) {
                let total = 0, completed = 0;
                const today = new Date();
                goal.linkedHabits.forEach(hid => {
                    const h = habits.find(x => x.id === hid);
                    if (!h) return;
                    for (let i = 0; i < 30; i++) {
                        const d = new Date(today);
                        d.setDate(d.getDate() - i);
                        const ds = d.toDateString();
                        if (new Date(h.createdAt) <= d) {
                            total++;
                            if (h.history && h.history[ds]) completed++;
                        }
                    }
                });
                habitPct = total > 0 ? (completed / total) * 100 : 0;
            }

            // Milestone component (30%): fraction of milestones completed
            if (goal.milestones && goal.milestones.length > 0) {
                const done = goal.milestones.filter(m => m.completed).length;
                milestonePct = (done / goal.milestones.length) * 100;
            }

            const hasHabits = goal.linkedHabits && goal.linkedHabits.length > 0;
            const hasMilestones = goal.milestones && goal.milestones.length > 0;

            if (hasHabits && hasMilestones) return Math.round(habitPct * 0.7 + milestonePct * 0.3);
            if (hasHabits)     return Math.round(habitPct);
            if (hasMilestones) return Math.round(milestonePct);
            return goal.manualProgress || 0;
        }

        // ---- RENDER GOALS PAGE ----
        function renderGoalsPage() {
            updateGoalStats();
            renderGoalsGrid();
            renderDashboardGoalsWidget();
        }

        function updateGoalStats() {
            const all = Object.values(goals);
            const active = all.filter(g => g.status === 'active');
            const achieved = all.filter(g => g.status === 'achieved');
            const milestonesHit = all.reduce((s, g) => s + (g.milestones || []).filter(m => m.completed).length, 0);
            const avgProg = active.length > 0
                ? Math.round(active.reduce((s, g) => s + calcGoalProgress(g), 0) / active.length)
                : 0;

            const set = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
            set('gstat-active', active.length);
            set('gstat-achieved', achieved.length);
            set('gstat-milestones', milestonesHit);
            set('gstat-avg', avgProg + '%');
        }

        function filterGoals(filter, el) {
            currentGoalFilter = filter;
            document.querySelectorAll('.goals-filter-tab').forEach(t => t.classList.remove('active'));
            if (el) el.classList.add('active');
            renderGoalsGrid();
        }

        function renderGoalsGrid() {
            const grid = document.getElementById('goals-grid');
            if (!grid) return;

            let list = Object.values(goals);
            if (currentGoalFilter === 'active')   list = list.filter(g => g.status === 'active');
            else if (currentGoalFilter === 'achieved') list = list.filter(g => g.status === 'achieved');
            else if (currentGoalFilter !== 'all') list = list.filter(g => g.area === currentGoalFilter);

            list.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            if (list.length === 0) {
                grid.innerHTML = `<div class="goals-empty">
                    <div class="goals-empty-icon">◎</div>
                    <h3 style="margin-bottom:0.5rem;">No goals yet</h3>
                    <p style="font-size:0.875rem; margin-bottom:1.5rem;">Every achievement starts with a decision to try.</p>
                    <button class="btn btn-primary" onclick="openGoalModal()">+ Set Your First Goal</button>
                </div>`;
                return;
            }

            grid.innerHTML = list.map(g => renderGoalCard(g)).join('');
        }

        // ---- GOAL CARD SVG ICONS (single-quoted attrs — safe inside template literals) ----
        const GOAL_SVG = {
            trophy: '<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'18\' height=\'18\' viewBox=\'0 0 24 24\' fill=\'none\' stroke=\'currentColor\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'><path d=\'M6 9H4.5a2.5 2.5 0 0 1 0-5H6\'/><path d=\'M18 9h1.5a2.5 2.5 0 0 0 0-5H18\'/><path d=\'M4 22h16\'/><path d=\'M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22\'/><path d=\'M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22\'/><path d=\'M18 2H6v7a6 6 0 0 0 12 0V2z\'/></svg>',
            edit:   '<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'18\' height=\'18\' viewBox=\'0 0 24 24\' fill=\'none\' stroke=\'currentColor\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'><path d=\'M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\'/><path d=\'M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\'/></svg>',
            trash:  '<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'18\' height=\'18\' viewBox=\'0 0 24 24\' fill=\'none\' stroke=\'currentColor\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'><polyline points=\'3 6 5 6 21 6\'/><path d=\'M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2\'/></svg>',
        };

        function renderGoalCard(goal) {
            const area = AREA_META[goal.area] || AREA_META.health;
            const pct = calcGoalProgress(goal);
            const isAchieved = goal.status === 'achieved' || pct >= 100;

            // Days remaining
            let dateStr = '';
            if (goal.targetDate) {
                const diff = Math.ceil((new Date(goal.targetDate) - new Date()) / 86400000);
                dateStr = diff > 0 ? `${diff}d left` : diff === 0 ? 'Today' : 'Overdue';
            }

            // Linked habits display
            const linkedNames = (goal.linkedHabits || [])
                .map(hid => habits.find(h => h.id === hid)?.name)
                .filter(Boolean);

            const milestonesHtml = (goal.milestones || []).map(m => `
                <div class="milestone-item ${m.completed ? 'done' : ''}" onclick="toggleMilestone('${goal.id}','${m.id}')">
                    <div class="milestone-check">${m.completed ? '✓' : ''}</div>
                    <span class="milestone-label">${m.label}</span>
                    ${m.completed && m.completedAt ? `<span class="milestone-date">${new Date(m.completedAt).toLocaleDateString('en-US',{month:'short',day:'numeric'})}</span>` : ''}
                </div>`).join('');

            const habitsHtml = linkedNames.length > 0
                ? `<div class="goal-habits-row">${linkedNames.map(n => `<span class="goal-habit-chip">✓ ${n}</span>`).join('')}</div>` : '';

            return `
                <div class="goal-card area-${goal.area}">
                    <div class="goal-card-accent"></div>
                    <div class="goal-card-body">
                        <div class="goal-card-header">
                            <span class="goal-area-badge">${area.label}</span>
                            <div class="goal-card-menu">
                                ${!isAchieved ? `<button onclick="markGoalAchieved('${goal.id}')" title="Mark achieved">${GOAL_SVG.trophy}</button>` : ''}
                                <button onclick="openGoalModal('${goal.id}')" title="Edit">${GOAL_SVG.edit}</button>
                                <button onclick="deleteGoal('${goal.id}')" title="Delete">${GOAL_SVG.trash}</button>
                            </div>
                        </div>
                        <div class="goal-card-title">${goal.title}</div>
                        <div class="goal-card-meta">
                            ${dateStr ? `<span class="goal-meta-item">${dateStr}</span>` : ''}
                            ${goal.milestones?.length ? `<span class="goal-meta-item">${goal.milestones.filter(m=>m.completed).length}/${goal.milestones.length} milestones</span>` : ''}
                            ${linkedNames.length ? `<span class="goal-meta-item">${linkedNames.length} habit${linkedNames.length>1?'s':''}</span>` : ''}
                        </div>
                        <div class="goal-progress-row">
                            <span class="goal-progress-label">Progress</span>
                            <span class="goal-progress-pct">${pct}%</span>
                        </div>
                        <div class="goal-progress-bar">
                            <div class="goal-progress-fill" style="width:${Math.min(pct,100)}%"></div>
                        </div>
                        ${goal.milestones?.length ? `<div class="goal-milestones"><div class="goal-milestones-title">Milestones</div>${milestonesHtml}</div>` : ''}
                        ${habitsHtml}
                    </div>
                    ${isAchieved ? `<div class="goal-achieved-banner">Goal Achieved</div>` : ''}
                </div>`;
        }

        // ---- MILESTONE TOGGLE ----
        function toggleMilestone(goalId, milestoneId) {
            const goal = goals[goalId];
            if (!goal) return;
            const m = goal.milestones.find(x => x.id === milestoneId);
            if (!m) return;
            m.completed = !m.completed;
            m.completedAt = m.completed ? new Date().toISOString() : null;
            // Auto-achieve if all milestones done and no habits
            if (!goal.linkedHabits?.length && goal.milestones.every(x => x.completed)) {
                goal.status = 'achieved';
                showToast('success', 'Goal Achieved!', goal.title);
            } else if (m.completed) {
                showToast('success', 'Milestone reached!', m.label);
            }
            saveGoals();
            renderGoalsGrid();
            updateGoalStats();
            renderDashboardGoalsWidget();

            // Bounce animation on the check
            setTimeout(() => {
                document.querySelectorAll('.milestone-check').forEach(el => {
                    const item = el.closest('.milestone-item');
                    if (item?.querySelector('.milestone-label')?.textContent?.trim() === m.label) {
                        el.classList.add('just-checked');
                        setTimeout(() => el.classList.remove('just-checked'), 400);
                    }
                });
            }, 20);
        }

        function markGoalAchieved(goalId) {
            if (!goals[goalId]) return;
            goals[goalId].status = 'achieved';
            saveGoals();
            showToast('success', 'Goal Achieved!', goals[goalId].title);
            renderGoalsPage();
        }

        function deleteGoal(goalId) {
            if (!confirm('Delete this goal? This cannot be undone.')) return;
            delete goals[goalId];
            saveGoals();
            renderGoalsPage();
        }

        // ---- DASHBOARD WIDGET ----
        function renderDashboardGoalsWidget() {
            const container = document.getElementById('dashboard-goals-list');
            if (!container) return;
            const active = Object.values(goals).filter(g => g.status === 'active').slice(0, 4);
            if (active.length === 0) {
                container.innerHTML = `<p style="color:var(--text-tertiary); font-size:0.875rem; text-align:center; padding:var(--space-md) 0;">No active goals — <span style="color:var(--accent-primary); cursor:pointer;" onclick="navigateTo('goals')">set your first goal</span></p>`;
                return;
            }
            container.innerHTML = active.map(g => {
                const area = AREA_META[g.area] || AREA_META.health;
                const pct = Math.min(100, calcGoalProgress(g));
                return `<div class="widget-goal-row area-${g.area}">
                    <div class="widget-goal-dot"></div>
                    <span class="widget-goal-name">${g.title}</span>
                    <div class="widget-goal-bar"><div class="widget-goal-bar-fill" style="width:${pct}%"></div></div>
                    <span class="widget-goal-pct">${pct}%</span>
                </div>`;
            }).join('');
        }

        // ---- GOAL MODAL ----
        function openGoalModal(goalId = null) {
            goalModalMode = goalId ? 'edit' : 'add';
            editingGoalId = goalId;
            goalFormMilestones = [];
            goalFormArea = 'health';
            goalFormLinkedHabits = [];

            document.getElementById('goal-modal-title').textContent = goalId ? 'Edit Goal' : 'New Goal';
            document.getElementById('gf-title').value = '';
            document.getElementById('gf-date').value = '';
            document.getElementById('gf-milestone-list').innerHTML = '';
            document.getElementById('gf-milestone-input').value = '';

            // Reset area picker
            document.querySelectorAll('.area-option').forEach(el => el.classList.remove('selected'));

            // Populate habit grid
            const habitGrid = document.getElementById('gf-habit-grid');
            if (habits.length === 0) {
                habitGrid.innerHTML = '<p style="color:var(--text-tertiary); font-size:0.82rem;">Add habits first to link them to goals.</p>';
            } else {
                habitGrid.innerHTML = habits.map(h => `
                    <div class="habit-link-option" id="hlo-${h.id}" onclick="toggleHabitLink('${h.id}')">
                        <input type="checkbox" id="hlc-${h.id}">
                        <span>${h.name}</span>
                    </div>`).join('');
            }

            // If editing, pre-fill
            if (goalId && goals[goalId]) {
                const g = goals[goalId];
                document.getElementById('gf-title').value = g.title;
                if (g.targetDate) document.getElementById('gf-date').value = g.targetDate;
                selectArea(g.area);
                goalFormMilestones = (g.milestones || []).map(m => ({...m}));
                goalFormLinkedHabits = [...(g.linkedHabits || [])];
                renderFormMilestones();
                goalFormLinkedHabits.forEach(hid => {
                    const opt = document.getElementById(`hlo-${hid}`);
                    const cb = document.getElementById(`hlc-${hid}`);
                    if (opt) opt.classList.add('selected');
                    if (cb) cb.checked = true;
                });
            } else {
                selectArea('health');
            }

            document.getElementById('goal-modal').classList.add('active');
            document.getElementById('gf-title').focus();
        }

        function closeGoalModal() {
            document.getElementById('goal-modal').classList.remove('active');
        }

        function selectArea(area) {
            goalFormArea = area;
            document.querySelectorAll('.area-option').forEach(el => {
                el.classList.toggle('selected', el.dataset.area === area);
            });
        }

        function toggleHabitLink(hid) {
            const opt = document.getElementById(`hlo-${hid}`);
            const cb = document.getElementById(`hlc-${hid}`);
            if (goalFormLinkedHabits.includes(hid)) {
                goalFormLinkedHabits = goalFormLinkedHabits.filter(x => x !== hid);
                opt && opt.classList.remove('selected');
                if (cb) cb.checked = false;
            } else {
                goalFormLinkedHabits.push(hid);
                opt && opt.classList.add('selected');
                if (cb) cb.checked = true;
            }
        }

        function addMilestoneToForm() {
            const input = document.getElementById('gf-milestone-input');
            const val = input.value.trim();
            if (!val || goalFormMilestones.length >= 5) return;
            goalFormMilestones.push({ id: 'ms_' + Date.now(), label: val, completed: false, completedAt: null });
            input.value = '';
            renderFormMilestones();
        }

        function renderFormMilestones() {
            const list = document.getElementById('gf-milestone-list');
            list.innerHTML = goalFormMilestones.map((m, i) => `
                <li class="milestone-input-item">
                    <span>${i + 1}. ${m.label}</span>
                    <button onclick="removeMilestoneFromForm(${i})">✕</button>
                </li>`).join('');
        }

        function removeMilestoneFromForm(idx) {
            goalFormMilestones.splice(idx, 1);
            renderFormMilestones();
        }

        function saveGoal() {
            const title = document.getElementById('gf-title').value.trim();
            if (!title) { showToast('error', 'Missing title', 'Please enter a goal title'); return; }

            const id = editingGoalId || genGoalId();
            const existing = goals[id] || {};

            goals[id] = {
                id,
                title,
                area: goalFormArea,
                targetDate: document.getElementById('gf-date').value || null,
                milestones: goalFormMilestones,
                linkedHabits: goalFormLinkedHabits,
                manualProgress: existing.manualProgress || 0,
                status: existing.status || 'active',
                createdAt: existing.createdAt || new Date().toISOString(),
                updatedAt: new Date().toISOString(),
            };

            saveGoals();
            closeGoalModal();
            showToast('success', goalModalMode === 'edit' ? 'Goal Updated' : 'Goal Created', title);
            renderGoalsPage();
        }

        // handle Enter key in milestone input
        document.addEventListener('DOMContentLoaded', () => {
            const mi = document.getElementById('gf-milestone-input');
            if (mi) mi.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); addMilestoneToForm(); }});
        });

        // ============================================
        // SOCIAL HUB — v1.3.9
        // ============================================

        const MOCK_FRIENDS = [
            { id: 'f1', name: 'Jordan Lee',  initials: 'JL', color: '#f97316', streak: 34, habits: 5, rate: 91, online: true,  badge: '🔥 On Fire',    badgeColor: 'rgba(249,115,22,0.15)',   badgeText: '#f97316' },
            { id: 'f2', name: 'Sam Rivera',  initials: 'SR', color: '#a78bfa', streak: 21, habits: 4, rate: 84, online: false, badge: '✨ Consistent', badgeColor: 'rgba(167,139,250,0.15)', badgeText: '#a78bfa' },
            { id: 'f3', name: 'Alex Kim',    initials: 'AK', color: '#34d399', streak: 57, habits: 6, rate: 96, online: true,  badge: '🏆 Legendary',  badgeColor: 'rgba(52,211,153,0.15)',  badgeText: '#34d399' },
            { id: 'f4', name: 'Maya Patel',  initials: 'MP', color: '#38bdf8', streak: 12, habits: 3, rate: 78, online: false, badge: '📈 Steady',      badgeColor: 'rgba(56,189,248,0.15)',  badgeText: '#38bdf8' },
        ];

        const MOCK_FEED = [
            { friendId: 'f3', type: 'milestone', text: 'Hit a 57-day streak — longest streak yet! 🏆', ago: '2m ago' },
            { friendId: 'f1', type: 'perfect',   text: 'Completed all 5 habits today. Perfect day! ✅', ago: '18m ago' },
            { friendId: 'f4', type: 'goal',      text: 'Reached 50% progress on "Run a 5K" goal 🏃', ago: '1h ago' },
            { friendId: 'f2', type: 'streak',    text: 'Kept their 21-day Meditation streak alive 🧘', ago: '2h ago' },
            { friendId: 'f3', type: 'perfect',   text: 'Another perfect day — 6 for 6 habits 🔥', ago: '5h ago' },
            { friendId: 'f1', type: 'badge',     text: 'Unlocked "On Fire" badge for 30-day streak 🔥', ago: '8h ago' },
            { friendId: 'f4', type: 'goal',      text: 'Added new goal: "Read 12 books this year" 📚', ago: '10h ago' },
            { friendId: 'f2', type: 'milestone', text: 'Journaled for 14 days straight — new record ✍️', ago: '1d ago' },
            { friendId: 'f3', type: 'streak',    text: 'Hit 50 days on "Cold Shower" habit ❄️', ago: '1d ago' },
            { friendId: 'f1', type: 'perfect',   text: 'Perfect week — 7 days all habits complete 🌟', ago: '2d ago' },
            { friendId: 'f4', type: 'streak',    text: 'Started a new streak on "Evening Walk" 🌆', ago: '3d ago' },
            { friendId: 'f2', type: 'goal',      text: 'Crushed "Learn Spanish" goal — 100% complete! 🎉', ago: '4d ago' },
        ];

        let activeSocialTab = 'feed';

        function initSocialProfile() {
            const stored = JSON.parse(localStorage.getItem('ascend-social-v1.3.9') || '{}');
            if (!stored.friendCode) {
                const num = Math.floor(1000 + Math.random() * 9000);
                stored.friendCode = `ASC-${num}`;
                stored.joinedAt = new Date().toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                stored.pendingFriends = [];
                localStorage.setItem('ascend-social-v1.3.9', JSON.stringify(stored));
            }
            return stored;
        }

        function renderSocialPage() {
            const profile = initSocialProfile();

            // Your profile card
            const codeEl = document.getElementById('social-your-code');
            const nameEl = document.getElementById('social-your-name');
            const joinedEl = document.getElementById('social-your-joined');
            const avatarEl = document.getElementById('social-your-avatar');
            if (codeEl) codeEl.textContent = profile.friendCode;
            if (joinedEl) joinedEl.textContent = `Joined ${profile.joinedAt}`;

            // Real stats from habits
            const today = new Date().toDateString();
            const doneToday = habits.filter(h => h.completions && h.completions[today]).length;
            const totalToday = habits.length || 0;
            const allStreaks = habits.map(h => {
                let streak = 0, d = new Date();
                while (true) {
                    const k = d.toDateString();
                    if (h.completions && h.completions[k]) { streak++; d.setDate(d.getDate()-1); }
                    else break;
                }
                return streak;
            });
            const maxStreak = allStreaks.length ? Math.max(...allStreaks) : 0;
            const rate = totalToday > 0 ? Math.round((doneToday/totalToday)*100) : 0;

            const displayName = profile.displayName || 'You';
            if (nameEl) nameEl.textContent = displayName;
            if (avatarEl) avatarEl.textContent = displayName.charAt(0).toUpperCase();
            const streakEl = document.getElementById('social-your-streak');
            const habitsEl = document.getElementById('social-your-habits');
            const rateEl   = document.getElementById('social-your-rate');
            if (streakEl) streakEl.textContent = maxStreak;
            if (habitsEl) habitsEl.textContent = totalToday;
            if (rateEl)   rateEl.textContent   = rate + '%';

            setSocialTab(activeSocialTab);
        }

        function setSocialTab(tab, btn) {
            activeSocialTab = tab;
            document.querySelectorAll('.social-tab').forEach(t => t.classList.remove('active'));
            if (btn) btn.classList.add('active');
            else document.querySelectorAll('.social-tab').forEach(t => {
                if (t.textContent.toLowerCase().includes(tab === 'feed' ? 'activity' : tab)) t.classList.add('active');
            });
            ['feed','friends','leaderboard'].forEach(p => {
                const el = document.getElementById(`social-panel-${p}`);
                if (el) el.style.display = p === tab ? '' : 'none';
            });
            if (tab === 'feed')        renderFeed();
            if (tab === 'friends')     renderFriends();
            if (tab === 'leaderboard') renderLeaderboard();
        }

        function renderFeed() {
            const panel = document.getElementById('social-panel-feed');
            if (!panel) return;
            const friendMap = Object.fromEntries(MOCK_FRIENDS.map(f => [f.id, f]));
            panel.innerHTML = `<div class="social-feed">${MOCK_FEED.map((item, i) => {
                const f = friendMap[item.friendId];
                return `<div class="social-feed-item" style="animation-delay:${i*0.045}s">
                    <div class="social-avatar" style="background:${f.color}22;color:${f.color};border-color:${f.color}44">${f.initials}</div>
                    <div class="social-feed-content">
                        <div class="social-feed-top">
                            <span class="social-feed-name">${f.name}</span>
                            <span class="social-feed-type ${item.type}">${item.type}</span>
                        </div>
                        <div class="social-feed-text">${item.text}</div>
                        <div class="social-feed-time">${item.ago}</div>
                    </div>
                </div>`;
            }).join('')}</div>`;
        }

        function renderFriends() {
            const panel = document.getElementById('social-panel-friends');
            if (!panel) return;
            const profile = initSocialProfile();
            const pending = profile.pendingFriends || [];

            const friendCards = MOCK_FRIENDS.map((f, i) => `
                <div class="social-friend-card" style="animation-delay:${i*0.07}s">
                    <div class="social-friend-header">
                        <div class="social-friend-avatar-wrap">
                            <div class="social-avatar social-avatar-lg" style="background:${f.color}22;color:${f.color};border-color:${f.color}44">${f.initials}</div>
                            <div class="social-online-dot${f.online ? '' : ' offline'}"></div>
                        </div>
                        <div>
                            <div class="social-friend-name">${f.name}</div>
                            <div class="social-friend-badges">
                                <span class="social-badge" style="background:${f.badgeColor};color:${f.badgeText}">${f.badge}</span>
                            </div>
                        </div>
                    </div>
                    <div class="social-friend-metrics">
                        <div class="social-metric"><div class="social-metric-val" style="color:${f.color}">${f.streak}</div><div class="social-metric-lbl">Streak</div></div>
                        <div class="social-metric"><div class="social-metric-val" style="color:${f.color}">${f.habits}</div><div class="social-metric-lbl">Habits</div></div>
                        <div class="social-metric"><div class="social-metric-val" style="color:${f.color}">${f.rate}%</div><div class="social-metric-lbl">Rate</div></div>
                    </div>
                    <div class="social-friend-bar-wrap">
                        <div class="social-friend-bar-label"><span>Completion Rate</span><span>${f.rate}%</span></div>
                        <div class="social-friend-bar-track"><div class="social-friend-bar-fill" style="width:${f.rate}%;background:${f.color}"></div></div>
                    </div>
                </div>`).join('');

            let pendingHTML = '';
            if (pending.length > 0) {
                pendingHTML = `<div class="social-pending-section">
                    <div class="social-pending-title">Pending (${pending.length})</div>
                    <div class="social-pending-list">${pending.map((code, i) => `
                        <div class="social-pending-item">
                            <div class="social-pending-code">${code}</div>
                            <div class="social-pending-label">Awaiting</div>
                            <button class="social-pending-remove" onclick="removePendingFriend('${code}')" title="Remove">✕</button>
                        </div>`).join('')}
                    </div>
                </div>`;
            }

            panel.innerHTML = `<div class="social-friends-grid">${friendCards}</div>${pendingHTML}`;
        }

        function renderLeaderboard() {
            const panel = document.getElementById('social-panel-leaderboard');
            if (!panel) return;
            const profile = initSocialProfile();
            const displayName = profile.displayName || 'You';

            // Build combined list with "you"
            const today = new Date().toDateString();
            const doneToday = habits.filter(h => h.completions && h.completions[today]).length;
            const totalToday = habits.length || 0;
            const allStreaks = habits.map(h => {
                let s = 0, d = new Date();
                while (h.completions && h.completions[d.toDateString()]) { s++; d.setDate(d.getDate()-1); }
                return s;
            });
            const myStreak = allStreaks.length ? Math.max(...allStreaks) : 0;
            const myRate   = totalToday > 0 ? Math.round((doneToday/totalToday)*100) : 0;

            const youEntry = { id: 'you', name: displayName, initials: displayName.charAt(0).toUpperCase(), color: 'var(--accent-primary)', streak: myStreak, rate: myRate, isYou: true };
            const allByStreak = [...MOCK_FRIENDS, youEntry].sort((a,b) => b.streak - a.streak);
            const allByRate   = [...MOCK_FRIENDS, youEntry].sort((a,b) => b.rate - a.rate);
            const rankClass   = ['gold','silver','bronze'];

            const buildBoard = (list, key, unit, title) => `
                <div class="social-lb-card">
                    <div class="social-lb-title">${title}</div>
                    ${list.map((entry, i) => `
                        <div class="social-lb-row${entry.isYou ? ' is-you' : ''}" style="animation-delay:${i*0.05}s">
                            <div class="social-lb-rank ${rankClass[i] || ''}">${i < 3 ? ['🥇','🥈','🥉'][i] : `#${i+1}`}</div>
                            <div class="social-lb-avatar" style="background:${entry.isYou ? 'var(--accent-primary)' : entry.color+'22'};color:${entry.isYou ? '#050508' : entry.color}">${entry.initials}</div>
                            <div class="social-lb-name">${entry.name}${entry.isYou ? '<span class="social-lb-you-tag">YOU</span>' : ''}</div>
                            <div><span class="social-lb-val">${entry[key]}</span><span class="social-lb-unit"> ${unit}</span></div>
                        </div>`).join('')}
                </div>`;

            panel.innerHTML = `<div class="social-leaderboard-wrap">
                ${buildBoard(allByStreak, 'streak', 'days', '🔥 Streak Rankings')}
                ${buildBoard(allByRate,   'rate',   '%',    '✅ Completion Rate')}
            </div>`;
        }

        function copyFriendCode() {
            const profile = initSocialProfile();
            navigator.clipboard.writeText(profile.friendCode).then(() => {
                showToast('success', 'Copied!', `${profile.friendCode} copied to clipboard`);
            }).catch(() => {
                showToast('info', 'Your Code', profile.friendCode);
            });
        }

        function formatFriendCodeInput(input) {
            let val = input.value.replace(/[^A-Za-z0-9]/g, '').toUpperCase();
            if (val.length > 3) val = val.slice(0,3) + '-' + val.slice(3,7);
            input.value = val;
        }

        function addFriendByCode() {
            const input = document.getElementById('social-add-input');
            const raw = (input.value || '').toUpperCase().trim();
            const valid = /^ASC-\d{4}$/.test(raw);

            if (!valid) {
                showToast('warning', 'Invalid Code', 'Use format ASC-XXXX (e.g. ASC-4827)');
                return;
            }
            const profile = initSocialProfile();
            if (raw === profile.friendCode) {
                showToast('warning', 'That\'s You!', 'You can\'t add yourself');
                return;
            }
            const mockCodes = MOCK_FRIENDS.map(f => `ASC-${f.id.replace('f','')}`);
            if (profile.pendingFriends.includes(raw)) {
                showToast('info', 'Already Added', `${raw} is already in your list`);
                return;
            }
            profile.pendingFriends.push(raw);
            localStorage.setItem('ascend-social-v1.3.9', JSON.stringify(profile));
            input.value = '';
            showToast('success', 'Friend Request Sent!', `Sent request to ${raw}`);
            if (activeSocialTab === 'friends') renderFriends();
        }

        function removePendingFriend(code) {
            const profile = initSocialProfile();
            profile.pendingFriends = profile.pendingFriends.filter(c => c !== code);
            localStorage.setItem('ascend-social-v1.3.9', JSON.stringify(profile));
            renderFriends();
            showToast('info', 'Removed', `Removed ${code}`);
        }

        function saveDisplayName() {
            const input = document.getElementById('settings-display-name');
            const name = (input.value || '').trim();
            if (!name) { showToast('warning', 'Empty Name', 'Please enter a display name'); return; }
            const profile = initSocialProfile();
            profile.displayName = name;
            localStorage.setItem('ascend-social-v1.3.9', JSON.stringify(profile));
            showToast('success', 'Saved!', `Display name set to "${name}"`);
        }

        function populateSettingsSocialFields() {
            const profile = initSocialProfile();
            const nameInput = document.getElementById('settings-display-name');
            const codeSpan  = document.getElementById('settings-friend-code');
            if (nameInput && profile.displayName) nameInput.value = profile.displayName;
            if (codeSpan) codeSpan.textContent = profile.friendCode;
        }

        // ============================================
        // KEYBOARD
        function handleKeyboard(e) {
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                navigateTo('habits');
                setTimeout(() => document.getElementById('habit-input').focus(), 100);
            }
            if (e.key === 'Escape') {
                const input = document.getElementById('habit-input');
                if (input === document.activeElement) input.blur();
                if (document.getElementById('day-modal').classList.contains('active')) {
                    closeDayModal();
                }
                if (document.getElementById('confirm-modal').classList.contains('active')) {
                    closeConfirmModal();
                }
            }
            // Arrow key navigation inside day modal
            if (document.getElementById('day-modal').classList.contains('active')) {
                if (e.key === 'ArrowLeft') { e.preventDefault(); navigateDay(-1); }
                if (e.key === 'ArrowRight') { e.preventDefault(); navigateDay(1); }
            }
        }

        // INIT
        init();

        // LOADING SCREEN v1.3.8 — cinematic 3.6s controller
        (function() {
            const screen = document.getElementById('loading-screen');
            if (!screen) return;

            // Generate star field
            const starContainer = document.getElementById('loader-stars');
            if (starContainer) {
                const starCount = 80;
                for (let i = 0; i < starCount; i++) {
                    const star = document.createElement('div');
                    star.className = 'loader-star';
                    const size = Math.random() * 2.2 + 0.6;
                    const opacity = Math.random() * 0.5 + 0.2;
                    star.style.cssText = [
                        `width:${size}px`, `height:${size}px`,
                        `left:${Math.random()*100}%`, `top:${Math.random()*100}%`,
                        `--star-opacity:${opacity}`,
                        `animation-delay:${Math.random()*0.8}s`,
                        `animation-duration:${0.4 + Math.random()*0.4}s`
                    ].join(';');
                    starContainer.appendChild(star);
                }
            }

            // Cycle status messages
            const statusEl = document.getElementById('loader-status');
            const messages = [
                'Initialising systems',
                'Loading habit data',
                'Syncing goals',
                'Preparing dashboard',
                'Ready for launch',
            ];
            let msgIdx = 0;
            const msgInterval = setInterval(() => {
                msgIdx = (msgIdx + 1) % messages.length;
                if (statusEl) statusEl.textContent = messages[msgIdx];
            }, 680);

            // Dismiss after 3.6s total
            setTimeout(() => {
                clearInterval(msgInterval);
                if (statusEl) statusEl.textContent = 'Launching';
                screen.classList.add('hidden');
                setTimeout(() => screen.remove(), 580);
            }, 3600);
        })();
    </script>
</body>
</html>